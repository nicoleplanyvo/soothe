<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>eazly – Life, gently organized</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
  <style>
    :root {
      --lotus: #C9A88C;
      --lotus-light: #DCC4AD;
      --lotus-dark: #A88B6C;
      --lotus-muted: #E8DDD2;
      --charcoal: #5C5552;
      --charcoal-light: #8A8582;
      --sand: #E8E2DB;
      --cream: #F5F3F0;
      --warmwhite: #FDFCFB;
      --sport: #9CB8A8;
      --sport-bg: #EBF2EE;
      --ernaehrung: #C9A87C;
      --ernaehrung-bg: #F8F0E3;
      --karriere: #A8B4C9;
      --karriere-bg: #EEF1F6;
      --familie: #D4A5A5;
      --familie-bg: #F9EDED;
      --finanzen: #A8B89D;
      --finanzen-bg: #EFF3EC;
      --selfcare: #C4A8C9;
      --selfcare-bg: #F5EDF6;
      --success: #7CB87C;
      --warning: #E8C87C;
      --danger: #D97B7B;
      --font-display: 'Cormorant Garamond', serif;
      --font-body: 'Quicksand', sans-serif;
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --shadow-soft: 0 4px 20px rgba(92,85,82,0.08);
      --shadow-md: 0 8px 30px rgba(92,85,82,0.12);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; }
    body { font-family: var(--font-body); background: var(--cream); color: var(--charcoal); min-height: 100vh; overflow-x: hidden; }

    .bg-animation { position: fixed; inset: 0; z-index: -1; overflow: hidden; }
    .bg-animation::before, .bg-animation::after { content: ''; position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.35; animation: float 20s ease-in-out infinite; }
    .bg-animation::before { width: 500px; height: 500px; background: var(--lotus-muted); top: -150px; left: -150px; }
    .bg-animation::after { width: 400px; height: 400px; background: var(--sand); bottom: -100px; right: -100px; animation-delay: -10s; }
    @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(30px, 30px) scale(1.1); } }

    .app { max-width: 430px; margin: 0 auto; min-height: 100vh; background: var(--warmwhite); position: relative; box-shadow: var(--shadow-md); }

    /* SCREENS */
    .screen { display: none; min-height: 100vh; padding-bottom: 90px; }
    .screen.active { display: block; }

    /* ONBOARDING */
    .onboarding { min-height: 100vh; display: flex; flex-direction: column; padding: 40px 24px; background: linear-gradient(180deg, var(--warmwhite) 0%, var(--cream) 100%); }
    .onboarding.hidden { display: none; }
    .onboarding-header { text-align: center; margin-bottom: 32px; }
    .onboarding-logo { width: 64px; height: 64px; margin-bottom: 12px; }
    .onboarding-brand { font-family: var(--font-display); font-size: 28px; font-weight: 500; color: var(--charcoal); letter-spacing: 0.5px; }
    .onboarding-progress { display: flex; justify-content: center; gap: 10px; margin-bottom: 40px; }
    .progress-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--sand); transition: all 0.3s ease; }
    .progress-dot.active { background: var(--lotus); transform: scale(1.2); }
    .progress-dot.completed { background: var(--lotus-light); }
    .onboarding-content { flex: 1; display: flex; flex-direction: column; }
    .onboarding-step { display: none; flex-direction: column; animation: fadeIn 0.4s ease; }
    .onboarding-step.active { display: flex; flex: 1; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .step-icon { width: 72px; height: 72px; margin: 0 auto 20px; background: var(--lotus-muted); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .step-icon .material-symbols-outlined { font-size: 36px; color: var(--lotus-dark); }
    .step-icon.sport { background: var(--sport-bg); } .step-icon.sport .material-symbols-outlined { color: var(--sport); }
    .step-icon.ernaehrung { background: var(--ernaehrung-bg); } .step-icon.ernaehrung .material-symbols-outlined { color: var(--ernaehrung); }
    .step-icon.karriere { background: var(--karriere-bg); } .step-icon.karriere .material-symbols-outlined { color: var(--karriere); }
    .step-icon.familie { background: var(--familie-bg); } .step-icon.familie .material-symbols-outlined { color: var(--familie); }
    .step-icon.finanzen { background: var(--finanzen-bg); } .step-icon.finanzen .material-symbols-outlined { color: var(--finanzen); }
    .step-icon.selfcare { background: var(--selfcare-bg); } .step-icon.selfcare .material-symbols-outlined { color: var(--selfcare); }
    .step-title { font-family: var(--font-display); font-size: 26px; font-weight: 500; text-align: center; margin-bottom: 8px; color: var(--charcoal); }
    .step-subtitle { text-align: center; color: var(--charcoal-light); font-size: 15px; line-height: 1.5; margin-bottom: 32px; }
    .step-content { flex: 1; }

    /* FORMS */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 13px; font-weight: 600; color: var(--charcoal); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .form-input { width: 100%; padding: 14px 16px; border: 1.5px solid var(--sand); border-radius: var(--radius-sm); font-family: var(--font-body); font-size: 16px; background: var(--warmwhite); color: var(--charcoal); transition: all 0.2s ease; }
    .form-input:focus { outline: none; border-color: var(--lotus); box-shadow: 0 0 0 3px rgba(201, 168, 140, 0.15); }
    .pillar-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .pillar-card { padding: 16px; border: 2px solid var(--sand); border-radius: var(--radius-md); text-align: center; cursor: pointer; transition: all 0.2s ease; background: var(--warmwhite); }
    .pillar-card:hover { border-color: var(--lotus-light); }
    .pillar-card.selected { border-color: var(--lotus); background: var(--lotus-muted); }
    .pillar-card .material-symbols-outlined { font-size: 28px; margin-bottom: 8px; display: block; }
    .pillar-card.sport .material-symbols-outlined { color: var(--sport); }
    .pillar-card.ernaehrung .material-symbols-outlined { color: var(--ernaehrung); }
    .pillar-card.karriere .material-symbols-outlined { color: var(--karriere); }
    .pillar-card.familie .material-symbols-outlined { color: var(--familie); }
    .pillar-card.finanzen .material-symbols-outlined { color: var(--finanzen); }
    .pillar-card.selfcare .material-symbols-outlined { color: var(--selfcare); }
    .pillar-card span:last-child { font-size: 13px; font-weight: 600; color: var(--charcoal); }
    .slider-container { margin-bottom: 24px; }
    .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .slider-value { font-size: 18px; font-weight: 700; color: var(--lotus-dark); }
    .slider { width: 100%; height: 6px; border-radius: 3px; background: var(--sand); outline: none; -webkit-appearance: none; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; background: var(--lotus); cursor: pointer; box-shadow: 0 2px 8px rgba(201, 168, 140, 0.4); }
    .option-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .option-btn { padding: 12px 20px; border: 2px solid var(--sand); border-radius: 50px; background: var(--warmwhite); font-family: var(--font-body); font-size: 14px; font-weight: 500; color: var(--charcoal); cursor: pointer; transition: all 0.2s ease; }
    .option-btn:hover { border-color: var(--lotus-light); }
    .option-btn.selected { border-color: var(--lotus); background: var(--lotus); color: white; }
    .children-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
    .child-card { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--familie-bg); border-radius: var(--radius-sm); }
    .child-card input { flex: 1; padding: 10px 12px; border: 1.5px solid transparent; border-radius: 8px; font-family: var(--font-body); font-size: 14px; background: var(--warmwhite); }
    .child-card input:focus { outline: none; border-color: var(--familie); }
    .child-card input[type="number"] { width: 70px; flex: none; }
    .remove-child { width: 32px; height: 32px; border: none; border-radius: 50%; background: var(--familie); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--cream); border-radius: var(--radius-sm); margin-bottom: 16px; }
    .toggle-label { font-weight: 500; }
    .toggle-sublabel { font-size: 12px; color: var(--charcoal-light); margin-top: 2px; }
    .toggle { width: 52px; height: 28px; border-radius: 14px; background: var(--sand); position: relative; cursor: pointer; transition: background 0.2s ease; }
    .toggle.active { background: var(--lotus); }
    .toggle::after { content: ''; position: absolute; width: 22px; height: 22px; border-radius: 50%; background: white; top: 3px; left: 3px; transition: transform 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .toggle.active::after { transform: translateX(24px); }
    .onboarding-nav { display: flex; gap: 12px; margin-top: auto; padding-top: 24px; }
    .btn { flex: 1; padding: 16px 24px; border: none; border-radius: var(--radius-sm); font-family: var(--font-body); font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn-secondary { background: var(--sand); color: var(--charcoal); }
    .btn-secondary:hover { background: var(--lotus-muted); }
    .btn-primary { background: var(--lotus); color: white; }
    .btn-primary:hover { background: var(--lotus-dark); }
    .btn-sm { padding: 10px 16px; font-size: 14px; flex: none; }
    .btn .material-symbols-outlined { font-size: 20px; }
    .info-message { display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: var(--lotus-muted); border-radius: var(--radius-sm); margin-top: 16px; font-size: 13px; color: var(--charcoal); }
    .info-message .material-symbols-outlined { font-size: 20px; color: var(--lotus-dark); flex-shrink: 0; }

    /* HEADER */
    .app-header { padding: 20px 20px 24px; background: linear-gradient(180deg, var(--warmwhite) 0%, transparent 100%); }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header-logo { display: flex; align-items: center; gap: 10px; }
    .header-logo svg { width: 36px; height: 36px; }
    .header-logo span { font-family: var(--font-display); font-size: 22px; font-weight: 500; color: var(--charcoal); }
    .header-actions { display: flex; gap: 8px; }
    .header-btn { width: 40px; height: 40px; border: none; border-radius: 50%; background: var(--cream); color: var(--charcoal); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; position: relative; }
    .header-btn:hover { background: var(--lotus-muted); }
    .header-btn .material-symbols-outlined { font-size: 22px; }
    .notification-badge { position: absolute; top: 6px; right: 6px; width: 8px; height: 8px; background: var(--danger); border-radius: 50%; }
    .greeting { margin-bottom: 4px; }
    .greeting-text { font-family: var(--font-display); font-size: 28px; font-weight: 500; color: var(--charcoal); }
    .greeting-date { font-size: 14px; color: var(--charcoal-light); }

    /* QUOTE CARD */
    .quote-card { margin: 0 20px 24px; padding: 20px; background: linear-gradient(135deg, var(--lotus-muted) 0%, var(--sand) 100%); border-radius: var(--radius-md); position: relative; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
    .quote-card:active { transform: scale(0.98); }
    .quote-card::before { content: '"'; position: absolute; top: -10px; left: 10px; font-family: var(--font-display); font-size: 80px; color: var(--lotus-light); opacity: 0.5; line-height: 1; }
    .quote-text { font-family: var(--font-display); font-size: 18px; font-style: italic; color: var(--charcoal); position: relative; z-index: 1; }

    /* SECTIONS */
    .section { padding: 0 20px; margin-bottom: 24px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .section-title { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--charcoal-light); }
    .section-link { font-size: 13px; font-weight: 600; color: var(--lotus); cursor: pointer; }

    /* PILLAR CARDS */
    .pillar-cards { display: flex; flex-direction: column; gap: 12px; }
    .dashboard-pillar { display: flex; align-items: center; padding: 16px; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; }
    .dashboard-pillar:hover { transform: translateX(4px); }
    .dashboard-pillar:active { transform: scale(0.98); }
    .dashboard-pillar.sport { background: var(--sport-bg); }
    .dashboard-pillar.ernaehrung { background: var(--ernaehrung-bg); }
    .dashboard-pillar.karriere { background: var(--karriere-bg); }
    .dashboard-pillar.familie { background: var(--familie-bg); }
    .dashboard-pillar.finanzen { background: var(--finanzen-bg); }
    .dashboard-pillar.selfcare { background: var(--selfcare-bg); }
    .pillar-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 14px; flex-shrink: 0; }
    .sport .pillar-icon { background: var(--sport); }
    .ernaehrung .pillar-icon { background: var(--ernaehrung); }
    .karriere .pillar-icon { background: var(--karriere); }
    .familie .pillar-icon { background: var(--familie); }
    .finanzen .pillar-icon { background: var(--finanzen); }
    .selfcare .pillar-icon { background: var(--selfcare); }
    .pillar-icon .material-symbols-outlined { font-size: 24px; color: white; }
    .pillar-info { flex: 1; min-width: 0; }
    .pillar-name { font-weight: 600; font-size: 15px; color: var(--charcoal); margin-bottom: 2px; }
    .pillar-status { font-size: 13px; color: var(--charcoal-light); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pillar-progress { width: 48px; height: 48px; position: relative; flex-shrink: 0; }
    .pillar-progress svg { transform: rotate(-90deg); }
    .pillar-progress circle { fill: none; stroke-width: 4; }
    .pillar-progress .bg { stroke: rgba(255,255,255,0.5); }
    .pillar-progress .progress { stroke: currentColor; stroke-linecap: round; transition: stroke-dashoffset 0.5s ease; }
    .sport .pillar-progress { color: var(--sport); }
    .ernaehrung .pillar-progress { color: var(--ernaehrung); }
    .karriere .pillar-progress { color: var(--karriere); }
    .familie .pillar-progress { color: var(--familie); }
    .finanzen .pillar-progress { color: var(--finanzen); }
    .selfcare .pillar-progress { color: var(--selfcare); }
    .progress-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
    .add-area-card { display: flex; align-items: center; padding: 16px; border: 2px dashed var(--sand); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; }
    .add-area-card:hover { border-color: var(--lotus); background: var(--lotus-muted); }
    .add-area-card .pillar-icon { background: var(--sand); }
    .add-area-card .material-symbols-outlined { color: var(--charcoal-light); }
    .add-area-card .pillar-name { color: var(--charcoal-light); }

    /* FOCUS CARDS */
    .focus-cards { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; margin: 0 -20px; padding-left: 20px; padding-right: 20px; scroll-snap-type: x mandatory; }
    .focus-cards::-webkit-scrollbar { display: none; }
    .focus-card { min-width: 160px; padding: 16px; background: var(--warmwhite); border: 1.5px solid var(--sand); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; scroll-snap-align: start; }
    .focus-card:hover { border-color: var(--lotus-light); }
    .focus-card:active { transform: scale(0.97); }
    .focus-card .material-symbols-outlined { font-size: 24px; margin-bottom: 10px; }
    .focus-card.sport .material-symbols-outlined { color: var(--sport); }
    .focus-card.ernaehrung .material-symbols-outlined { color: var(--ernaehrung); }
    .focus-card.karriere .material-symbols-outlined { color: var(--karriere); }
    .focus-card.familie .material-symbols-outlined { color: var(--familie); }
    .focus-card.finanzen .material-symbols-outlined { color: var(--finanzen); }
    .focus-card.selfcare .material-symbols-outlined { color: var(--selfcare); }
    .focus-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
    .focus-desc { font-size: 12px; color: var(--charcoal-light); }
    .focus-time { font-size: 11px; color: var(--lotus); font-weight: 600; margin-top: 8px; }

    /* TASK LIST */
    .task-list { display: flex; flex-direction: column; gap: 8px; }
    .task-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--warmwhite); border: 1px solid var(--sand); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; }
    .task-item:hover { border-color: var(--lotus-light); }
    .task-item.completed { opacity: 0.6; }
    .task-item.completed .task-text { text-decoration: line-through; }
    .task-checkbox { width: 22px; height: 22px; border: 2px solid var(--sand); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
    .task-item.completed .task-checkbox { background: var(--success); border-color: var(--success); }
    .task-checkbox .material-symbols-outlined { font-size: 16px; color: white; opacity: 0; }
    .task-item.completed .task-checkbox .material-symbols-outlined { opacity: 1; }
    .task-content { flex: 1; min-width: 0; }
    .task-text { font-size: 14px; font-weight: 500; }
    .task-meta { font-size: 12px; color: var(--charcoal-light); margin-top: 2px; }
    .task-priority { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .task-priority.high { background: var(--danger); }
    .task-priority.medium { background: var(--warning); }
    .task-priority.low { background: var(--success); }

    /* BOTTOM NAV */
    .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: var(--warmwhite); border-top: 1px solid var(--sand); display: flex; justify-content: space-around; padding: 12px 0 20px; z-index: 100; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; background: none; border: none; cursor: pointer; color: var(--charcoal-light); transition: color 0.2s ease; }
    .nav-item:hover, .nav-item.active { color: var(--lotus); }
    .nav-item .material-symbols-outlined { font-size: 26px; }
    .nav-item span:last-child { font-size: 11px; font-weight: 500; }

    /* DETAIL HEADER */
    .detail-header { display: flex; align-items: center; gap: 12px; padding: 20px; background: var(--warmwhite); border-bottom: 1px solid var(--sand); position: sticky; top: 0; z-index: 10; }
    .back-btn { width: 40px; height: 40px; border: none; border-radius: 50%; background: var(--cream); color: var(--charcoal); cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .detail-header h1 { font-family: var(--font-display); font-size: 24px; font-weight: 500; flex: 1; }
    .detail-header .header-btn { flex-shrink: 0; }

    /* STATS ROW */
    .stats-row { display: flex; gap: 12px; padding: 20px; overflow-x: auto; }
    .stat-card { flex: 1; min-width: 100px; padding: 16px; background: var(--cream); border-radius: var(--radius-sm); text-align: center; }
    .stat-value { font-size: 24px; font-weight: 700; color: var(--charcoal); }
    .stat-label { font-size: 11px; color: var(--charcoal-light); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }

    /* CALENDAR */
    .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; }
    .calendar-month { font-family: var(--font-display); font-size: 20px; font-weight: 500; }
    .calendar-nav { display: flex; gap: 8px; }
    .calendar-nav button { width: 36px; height: 36px; border: none; border-radius: 50%; background: var(--cream); cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; padding: 0 20px 20px; }
    .calendar-day-name { font-size: 11px; font-weight: 600; color: var(--charcoal-light); text-align: center; padding: 8px 0; }
    .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; position: relative; }
    .calendar-day:hover { background: var(--cream); }
    .calendar-day.today { background: var(--lotus); color: white; }
    .calendar-day.selected { background: var(--lotus-muted); }
    .calendar-day.other-month { color: var(--sand); }
    .calendar-day .event-dot { position: absolute; bottom: 4px; width: 4px; height: 4px; border-radius: 50%; background: var(--lotus); }
    .calendar-day.today .event-dot { background: white; }
    .calendar-events { padding: 0 20px; }
    .event-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--warmwhite); border-radius: var(--radius-sm); margin-bottom: 8px; border-left: 4px solid var(--lotus); cursor: pointer; transition: transform 0.2s; }
    .event-item:active { transform: scale(0.98); }
    .event-item.sport { border-color: var(--sport); }
    .event-item.ernaehrung { border-color: var(--ernaehrung); }
    .event-item.karriere { border-color: var(--karriere); }
    .event-item.familie { border-color: var(--familie); }
    .event-item.finanzen { border-color: var(--finanzen); }
    .event-item.selfcare { border-color: var(--selfcare); }
    .event-time { font-size: 13px; font-weight: 600; color: var(--charcoal); min-width: 50px; }
    .event-info { flex: 1; }
    .event-title { font-size: 14px; font-weight: 500; }
    .event-location { font-size: 12px; color: var(--charcoal-light); }

    /* RECIPE CARD */
    .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 20px; }
    .recipe-card { background: var(--warmwhite); border-radius: var(--radius-md); overflow: hidden; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .recipe-card:active { transform: scale(0.97); }
    .recipe-image { height: 100px; background: linear-gradient(135deg, var(--ernaehrung-bg), var(--sand)); display: flex; align-items: center; justify-content: center; }
    .recipe-image .material-symbols-outlined { font-size: 40px; color: var(--ernaehrung); }
    .recipe-content { padding: 12px; }
    .recipe-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .recipe-meta { font-size: 12px; color: var(--charcoal-light); display: flex; gap: 8px; }

    /* TRANSACTION LIST */
    .transaction-list { padding: 0 20px; }
    .transaction-item { display: flex; align-items: center; gap: 12px; padding: 14px 0; border-bottom: 1px solid var(--sand); }
    .transaction-item:last-child { border-bottom: none; }
    .transaction-icon { width: 44px; height: 44px; border-radius: 12px; background: var(--cream); display: flex; align-items: center; justify-content: center; }
    .transaction-icon .material-symbols-outlined { font-size: 22px; color: var(--charcoal-light); }
    .transaction-info { flex: 1; }
    .transaction-name { font-size: 14px; font-weight: 500; }
    .transaction-category { font-size: 12px; color: var(--charcoal-light); }
    .transaction-amount { font-size: 15px; font-weight: 600; }
    .transaction-amount.expense { color: var(--danger); }
    .transaction-amount.income { color: var(--success); }

    /* NOTIFICATIONS */
    .notification-list { padding: 20px; }
    .notification-item { display: flex; gap: 12px; padding: 16px; background: var(--warmwhite); border-radius: var(--radius-sm); margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
    .notification-item:hover { background: var(--cream); }
    .notification-item.unread { border-left: 3px solid var(--lotus); }
    .notification-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .notification-icon.sport { background: var(--sport-bg); color: var(--sport); }
    .notification-icon.ernaehrung { background: var(--ernaehrung-bg); color: var(--ernaehrung); }
    .notification-icon.karriere { background: var(--karriere-bg); color: var(--karriere); }
    .notification-icon.familie { background: var(--familie-bg); color: var(--familie); }
    .notification-icon.finanzen { background: var(--finanzen-bg); color: var(--finanzen); }
    .notification-icon.selfcare { background: var(--selfcare-bg); color: var(--selfcare); }
    .notification-content { flex: 1; }
    .notification-title { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
    .notification-text { font-size: 13px; color: var(--charcoal-light); line-height: 1.4; }
    .notification-time { font-size: 11px; color: var(--charcoal-light); margin-top: 6px; }

    /* SETTINGS */
    .settings-content { padding: 20px; }
    .settings-section { margin-bottom: 24px; }
    .settings-section-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--charcoal-light); margin-bottom: 12px; padding-left: 4px; }
    .settings-card { background: var(--warmwhite); border-radius: var(--radius-md); overflow: hidden; box-shadow: var(--shadow-soft); }
    .settings-item { display: flex; align-items: center; padding: 16px; cursor: pointer; transition: background 0.2s ease; border-bottom: 1px solid var(--sand); }
    .settings-item:last-child { border-bottom: none; }
    .settings-item:hover { background: var(--cream); }
    .settings-item .material-symbols-outlined { font-size: 24px; color: var(--charcoal-light); margin-right: 14px; }
    .settings-item-content { flex: 1; }
    .settings-item-title { font-weight: 500; font-size: 15px; margin-bottom: 2px; }
    .settings-item-desc { font-size: 13px; color: var(--charcoal-light); }
    .settings-item .chevron { color: var(--sand); }
    .settings-item.sport .material-symbols-outlined:first-child { color: var(--sport); }
    .settings-item.ernaehrung .material-symbols-outlined:first-child { color: var(--ernaehrung); }
    .settings-item.karriere .material-symbols-outlined:first-child { color: var(--karriere); }
    .settings-item.familie .material-symbols-outlined:first-child { color: var(--familie); }
    .settings-item.finanzen .material-symbols-outlined:first-child { color: var(--finanzen); }
    .settings-item.selfcare .material-symbols-outlined:first-child { color: var(--selfcare); }
    .settings-item.inactive { opacity: 0.6; }
    .settings-item.danger { color: var(--danger); }
    .settings-item.danger .material-symbols-outlined { color: var(--danger); }
    .profile-card { display: flex; align-items: center; padding: 20px; background: var(--warmwhite); border-radius: var(--radius-md); margin-bottom: 24px; box-shadow: var(--shadow-soft); }
    .profile-avatar { width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, var(--lotus-light), var(--lotus)); display: flex; align-items: center; justify-content: center; margin-right: 16px; }
    .profile-avatar .material-symbols-outlined { font-size: 32px; color: white; }
    .profile-info h3 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
    .profile-info p { font-size: 14px; color: var(--charcoal-light); }
    .settings-toggle { width: 48px; height: 26px; border-radius: 13px; background: var(--sand); position: relative; cursor: pointer; transition: background 0.2s ease; flex-shrink: 0; }
    .settings-toggle.active { background: var(--lotus); }
    .settings-toggle::after { content: ''; position: absolute; width: 20px; height: 20px; border-radius: 50%; background: white; top: 3px; left: 3px; transition: transform 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .settings-toggle.active::after { transform: translateX(22px); }
    .add-badge { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: var(--lotus); color: white; border-radius: 50%; font-size: 18px; }
    .remove-badge { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: var(--danger); color: white; border-radius: 50%; font-size: 18px; }

    /* MODALS */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 200; padding: 20px; }
    .modal-overlay.active { display: flex; }
    .modal { width: 100%; max-width: 380px; background: var(--warmwhite); border-radius: var(--radius-lg); padding: 24px; animation: modalIn 0.3s ease; max-height: 90vh; overflow-y: auto; }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-family: var(--font-display); font-size: 22px; font-weight: 500; }
    .modal-close { width: 36px; height: 36px; border: none; border-radius: 50%; background: var(--cream); cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .modal-footer { display: flex; gap: 12px; margin-top: 24px; }
    .add-pillar-item { display: flex; align-items: center; padding: 14px; border: 2px solid var(--sand); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s ease; margin-bottom: 8px; }
    .add-pillar-item:hover { border-color: var(--lotus-light); }
    .add-pillar-item.disabled { opacity: 0.5; cursor: not-allowed; background: var(--cream); }
    .add-pillar-item .material-symbols-outlined { font-size: 24px; margin-right: 12px; }
    .add-pillar-item.sport .material-symbols-outlined { color: var(--sport); }
    .add-pillar-item.ernaehrung .material-symbols-outlined { color: var(--ernaehrung); }
    .add-pillar-item.karriere .material-symbols-outlined { color: var(--karriere); }
    .add-pillar-item.familie .material-symbols-outlined { color: var(--familie); }
    .add-pillar-item.finanzen .material-symbols-outlined { color: var(--finanzen); }
    .add-pillar-item.selfcare .material-symbols-outlined { color: var(--selfcare); }
    .add-pillar-item span:last-child { flex: 1; font-weight: 500; }
    .add-pillar-item .check { color: var(--lotus); }

    /* RECIPE DETAIL */
    .recipe-detail-image { height: 200px; background: linear-gradient(135deg, var(--ernaehrung-bg), var(--sand)); display: flex; align-items: center; justify-content: center; }
    .recipe-detail-image .material-symbols-outlined { font-size: 80px; color: var(--ernaehrung); }
    .recipe-detail-content { padding: 20px; }
    .recipe-detail-title { font-family: var(--font-display); font-size: 28px; font-weight: 500; margin-bottom: 8px; }
    .recipe-detail-meta { display: flex; gap: 16px; margin-bottom: 20px; }
    .recipe-detail-meta span { display: flex; align-items: center; gap: 4px; font-size: 13px; color: var(--charcoal-light); }
    .recipe-detail-meta .material-symbols-outlined { font-size: 18px; }
    .nutrition-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 24px; }
    .nutrition-item { text-align: center; padding: 12px 8px; background: var(--cream); border-radius: var(--radius-sm); }
    .nutrition-value { font-size: 18px; font-weight: 700; color: var(--ernaehrung); }
    .nutrition-label { font-size: 10px; color: var(--charcoal-light); text-transform: uppercase; }
    .ingredient-list { margin-bottom: 24px; }
    .ingredient-item { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--sand); }
    .ingredient-item:last-child { border-bottom: none; }
    .ingredient-amount { font-weight: 600; min-width: 60px; }

    /* WORKOUT CARD */
    .workout-card { background: var(--warmwhite); border-radius: var(--radius-md); padding: 16px; margin: 0 20px 12px; border: 1px solid var(--sand); cursor: pointer; transition: all 0.2s; }
    .workout-card:active { transform: scale(0.98); }
    .workout-card.completed { opacity: 0.6; border-color: var(--success); }
    .workout-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
    .workout-title { font-size: 16px; font-weight: 600; }
    .workout-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .workout-badge.planned { background: var(--sport-bg); color: var(--sport); }
    .workout-badge.done { background: var(--success); color: white; }
    .workout-stats { display: flex; gap: 16px; }
    .workout-stat { display: flex; align-items: center; gap: 4px; font-size: 13px; color: var(--charcoal-light); }
    .workout-stat .material-symbols-outlined { font-size: 18px; }

    /* MEAL PLANNER */
    .meal-planner { padding: 0 20px; }
    .meal-day-tabs { display: flex; gap: 6px; overflow-x: auto; padding: 0 20px 16px; }
    .meal-day-tabs::-webkit-scrollbar { display: none; }
    .meal-day-tab { min-width: 52px; padding: 10px 8px; border-radius: var(--radius-sm); background: var(--cream); text-align: center; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
    .meal-day-tab.active { background: var(--ernaehrung); color: white; border-color: var(--ernaehrung); }
    .meal-day-tab .day-name { font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .meal-day-tab .day-num { font-size: 16px; font-weight: 700; margin-top: 2px; }
    .meal-slot { background: var(--warmwhite); border: 1.5px solid var(--sand); border-radius: var(--radius-md); padding: 14px; margin: 0 20px 10px; cursor: pointer; transition: all 0.2s; }
    .meal-slot:hover { border-color: var(--ernaehrung); }
    .meal-slot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .meal-slot-label { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--charcoal-light); }
    .meal-slot-kcal { font-size: 12px; color: var(--ernaehrung); font-weight: 600; }
    .meal-slot-content { display: flex; align-items: center; gap: 10px; }
    .meal-slot-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--ernaehrung-bg); display: flex; align-items: center; justify-content: center; }
    .meal-slot-icon .material-symbols-outlined { font-size: 20px; color: var(--ernaehrung); }
    .meal-slot-info { flex: 1; }
    .meal-slot-title { font-size: 14px; font-weight: 600; }
    .meal-slot-meta { font-size: 12px; color: var(--charcoal-light); }
    .meal-slot.empty { border-style: dashed; opacity: 0.7; }
    .meal-slot.empty .meal-slot-title { color: var(--charcoal-light); }
    .meal-summary { display: flex; gap: 12px; padding: 16px 20px; }
    .meal-summary-item { flex: 1; text-align: center; padding: 12px 8px; background: var(--ernaehrung-bg); border-radius: var(--radius-sm); }
    .meal-summary-value { font-size: 18px; font-weight: 700; color: var(--ernaehrung); }
    .meal-summary-label { font-size: 10px; color: var(--charcoal-light); text-transform: uppercase; margin-top: 2px; }

    /* SHOPPING LIST */
    .shopping-section { padding: 0 20px; margin-bottom: 20px; }
    .shopping-category { margin-bottom: 16px; }
    .shopping-category-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--ernaehrung); margin-bottom: 8px; padding-left: 4px; }
    .shopping-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--warmwhite); border: 1px solid var(--sand); border-radius: var(--radius-sm); margin-bottom: 6px; cursor: pointer; transition: all 0.2s; }
    .shopping-item:hover { border-color: var(--ernaehrung); }
    .shopping-item.checked { opacity: 0.5; }
    .shopping-item.checked .shopping-text { text-decoration: line-through; }
    .shopping-check { width: 22px; height: 22px; border: 2px solid var(--sand); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; }
    .shopping-item.checked .shopping-check { background: var(--ernaehrung); border-color: var(--ernaehrung); }
    .shopping-check .material-symbols-outlined { font-size: 16px; color: white; opacity: 0; }
    .shopping-item.checked .shopping-check .material-symbols-outlined { opacity: 1; }
    .shopping-text { flex: 1; font-size: 14px; }
    .shopping-amount { font-size: 13px; color: var(--charcoal-light); font-weight: 500; }

    /* WEIGHT TRACKING */
    .weight-input-card { background: var(--warmwhite); border-radius: var(--radius-md); padding: 20px; margin: 0 20px 20px; box-shadow: var(--shadow-soft); }
    .weight-input-row { display: flex; align-items: center; gap: 12px; }
    .weight-input { flex: 1; padding: 14px 16px; border: 2px solid var(--sand); border-radius: var(--radius-sm); font-family: var(--font-body); font-size: 24px; font-weight: 700; text-align: center; background: var(--cream); color: var(--charcoal); }
    .weight-input:focus { outline: none; border-color: var(--sport); }
    .weight-unit { font-size: 16px; font-weight: 600; color: var(--charcoal-light); }
    .weight-chart { background: var(--warmwhite); border-radius: var(--radius-md); padding: 20px; margin: 0 20px 20px; }
    .weight-chart-area { height: 160px; position: relative; border-bottom: 1px solid var(--sand); margin-bottom: 8px; }
    .weight-line { position: absolute; bottom: 0; left: 0; right: 0; height: 100%; }
    .weight-point { position: absolute; width: 10px; height: 10px; border-radius: 50%; background: var(--sport); border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transform: translate(-50%, 50%); }
    .weight-chart-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--charcoal-light); }
    .weight-stats { display: flex; gap: 12px; padding: 0 20px; margin-bottom: 20px; }
    .weight-stat { flex: 1; text-align: center; padding: 14px; background: var(--sport-bg); border-radius: var(--radius-sm); }
    .weight-stat-value { font-size: 20px; font-weight: 700; color: var(--sport); }
    .weight-stat-label { font-size: 11px; color: var(--charcoal-light); text-transform: uppercase; margin-top: 2px; }

    /* HABIT TRACKER */
    .habit-list { padding: 0 20px; }
    .habit-card { background: var(--warmwhite); border: 1.5px solid var(--sand); border-radius: var(--radius-md); padding: 16px; margin-bottom: 10px; transition: all 0.2s; }
    .habit-card.completed-today { border-color: var(--success); background: linear-gradient(135deg, var(--warmwhite), rgba(124, 184, 124, 0.05)); }
    .habit-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .habit-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
    .habit-icon .material-symbols-outlined { font-size: 22px; color: white; }
    .habit-info { flex: 1; }
    .habit-name { font-size: 15px; font-weight: 600; }
    .habit-streak { font-size: 12px; color: var(--charcoal-light); display: flex; align-items: center; gap: 4px; }
    .habit-streak .material-symbols-outlined { font-size: 14px; color: var(--warning); }
    .habit-check-btn { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--sand); background: var(--warmwhite); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .habit-check-btn.checked { background: var(--success); border-color: var(--success); }
    .habit-check-btn .material-symbols-outlined { font-size: 20px; color: var(--sand); }
    .habit-check-btn.checked .material-symbols-outlined { color: white; }
    .habit-week { display: flex; gap: 4px; }
    .habit-day { width: 100%; height: 6px; border-radius: 3px; background: var(--sand); }
    .habit-day.done { background: var(--success); }
    .habit-day.today { outline: 2px solid var(--charcoal-light); outline-offset: 1px; }

    /* PREMIUM */
    .premium-banner { margin: 0 20px 20px; padding: 20px; background: linear-gradient(135deg, var(--lotus), var(--lotus-dark)); border-radius: var(--radius-md); color: white; position: relative; overflow: hidden; cursor: pointer; }
    .premium-banner::after { content: ''; position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; }
    .premium-banner-title { font-family: var(--font-display); font-size: 20px; font-weight: 500; margin-bottom: 4px; }
    .premium-banner-text { font-size: 13px; opacity: 0.9; margin-bottom: 12px; }
    .premium-badge { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 50px; font-size: 13px; font-weight: 600; }
    .premium-modal-features { list-style: none; padding: 0; }
    .premium-modal-features li { display: flex; align-items: center; gap: 10px; padding: 12px 0; border-bottom: 1px solid var(--sand); font-size: 14px; }
    .premium-modal-features li:last-child { border-bottom: none; }
    .premium-modal-features .material-symbols-outlined { color: var(--lotus); font-size: 20px; }
    .premium-price-cards { display: flex; gap: 12px; margin: 20px 0; }
    .premium-price-card { flex: 1; padding: 16px; border: 2px solid var(--sand); border-radius: var(--radius-md); text-align: center; cursor: pointer; transition: all 0.2s; position: relative; }
    .premium-price-card:hover { border-color: var(--lotus-light); }
    .premium-price-card.selected { border-color: var(--lotus); background: var(--lotus-muted); }
    .premium-price-card.popular::before { content: 'Beliebt'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--lotus); color: white; padding: 2px 10px; border-radius: 10px; font-size: 11px; font-weight: 600; }
    .premium-price-amount { font-size: 24px; font-weight: 700; color: var(--charcoal); }
    .premium-price-period { font-size: 12px; color: var(--charcoal-light); }
    .premium-price-save { font-size: 11px; color: var(--success); font-weight: 600; margin-top: 4px; }

    /* FAB */
    .fab { position: fixed; bottom: 100px; right: calc(50% - 195px); width: 56px; height: 56px; border-radius: 50%; background: var(--lotus); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(201, 168, 140, 0.4); transition: all 0.2s; z-index: 50; }
    .fab:hover { transform: scale(1.05); }
    .fab:active { transform: scale(0.95); }
    .fab .material-symbols-outlined { font-size: 28px; }

    /* CONFETTI */
    .confetti { position: fixed; width: 10px; height: 10px; pointer-events: none; z-index: 400; animation: confetti-fall 3s ease-out forwards; }
    @keyframes confetti-fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

    /* EMPTY STATE */
    .empty-state { text-align: center; padding: 40px 20px; }
    .empty-state .material-symbols-outlined { font-size: 64px; color: var(--sand); margin-bottom: 16px; }
    .empty-state h3 { font-family: var(--font-display); font-size: 20px; margin-bottom: 8px; }
    .empty-state p { color: var(--charcoal-light); font-size: 14px; margin-bottom: 20px; }
    .empty-state .btn { display: inline-flex; flex: none; }

    /* TABS */
    .tabs { display: flex; gap: 8px; padding: 0 20px 16px; overflow-x: auto; }
    .tab { padding: 10px 20px; border-radius: 50px; background: var(--cream); font-size: 13px; font-weight: 600; color: var(--charcoal-light); border: none; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .tab.active { background: var(--lotus); color: white; }

    /* CHART PLACEHOLDER */
    .chart-container { padding: 20px; background: var(--warmwhite); margin: 0 20px 20px; border-radius: var(--radius-md); }
    .chart-placeholder { height: 150px; display: flex; align-items: flex-end; gap: 8px; padding-top: 20px; }
    .chart-bar { flex: 1; background: var(--lotus-muted); border-radius: 4px 4px 0 0; transition: height 0.5s ease; }
    .chart-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 11px; color: var(--charcoal-light); }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="app" id="app">
    <!-- All screens will be rendered here -->
  </div>

  <script>
    // ══════════════════════════════════════════════════════════════
    // APP CONTENT (nicht User-Daten, bleiben immer)
    // ══════════════════════════════════════════════════════════════
    const APP_CONTENT = {
      quotes: [
        "Fortschritt, nicht Perfektion.",
        "Sei sanft zu dir selbst.",
        "Kleine Schritte, grosse Wirkung.",
        "Heute ist ein guter Tag fuer einen guten Tag.",
        "Du bist genug, genau so wie du bist.",
        "Jeder Tag ist eine neue Chance."
      ],
      recipes: [
        { id: 1, title: 'Avocado Toast', time: 10, difficulty: 'Einfach', calories: 320, protein: 12, carbs: 28, fat: 18, ingredients: ['2 Scheiben Vollkornbrot', '1 reife Avocado', '2 Eier', 'Salz & Pfeffer', 'Chiliflocken'] },
        { id: 2, title: 'Buddha Bowl', time: 25, difficulty: 'Mittel', calories: 480, protein: 18, carbs: 52, fat: 22, ingredients: ['150g Quinoa', '100g Kichererbsen', '1 Suesskartoffel', 'Spinat', 'Tahini-Dressing'] },
        { id: 3, title: 'Gruener Smoothie', time: 5, difficulty: 'Einfach', calories: 180, protein: 6, carbs: 32, fat: 4, ingredients: ['1 Banane', '1 Handvoll Spinat', '200ml Mandelmilch', '1 EL Chiasamen'] },
        { id: 4, title: 'Lachs mit Gemuese', time: 35, difficulty: 'Mittel', calories: 520, protein: 38, carbs: 24, fat: 28, ingredients: ['200g Lachsfilet', 'Brokkoli', 'Zucchini', 'Zitrone', 'Olivenoel'] },
        { id: 5, title: 'Overnight Oats', time: 5, difficulty: 'Einfach', calories: 380, protein: 14, carbs: 58, fat: 10, ingredients: ['50g Haferflocken', '150ml Milch', 'Beeren', 'Honig', 'Nuesse'] },
        { id: 6, title: 'Quinoa Salat', time: 20, difficulty: 'Einfach', calories: 420, protein: 16, carbs: 48, fat: 18, ingredients: ['150g Quinoa', 'Gurke', 'Tomaten', 'Feta', 'Minze'] }
      ],
      journalPrompts: [
        'Wofuer bin ich heute dankbar?',
        'Was hat mich heute zum Laecheln gebracht?',
        'Welche kleine Sache kann ich heute fuer mich tun?',
        'Was moechte ich loslassen?',
        'Was gibt mir gerade Kraft?',
        'Worauf freue ich mich diese Woche?'
      ],
      miniExercises: [
        { title: 'Box Breathing', desc: '4 Sek einatmen, 4 halten, 4 ausatmen', duration: '3 Min', icon: 'air' },
        { title: 'Body Scan', desc: 'Spuere kurz in deinen Koerper hinein', duration: '5 Min', icon: 'accessibility_new' },
        { title: 'Dankbarkeit', desc: 'Nenne 3 Dinge fuer die du dankbar bist', duration: '2 Min', icon: 'favorite' },
        { title: 'Achtsamer Tee', desc: 'Trinke bewusst eine Tasse Tee', duration: '10 Min', icon: 'coffee' },
        { title: 'Stretching', desc: '5 sanfte Dehnuebungen am Schreibtisch', duration: '5 Min', icon: 'self_improvement' }
      ]
    };

    const PILLARS = {
      sport: { id: 'sport', name: 'Sport', icon: 'fitness_center', color: 'sport' },
      ernaehrung: { id: 'ernaehrung', name: 'Ernaehrung', icon: 'restaurant', color: 'ernaehrung' },
      selfcare: { id: 'selfcare', name: 'Selfcare', icon: 'spa', color: 'selfcare' },
      karriere: { id: 'karriere', name: 'Karriere', icon: 'work', color: 'karriere' },
      familie: { id: 'familie', name: 'Familie', icon: 'family_restroom', color: 'familie' },
      finanzen: { id: 'finanzen', name: 'Finanzen', icon: 'account_balance_wallet', color: 'finanzen' }
    };
    const PILLAR_ORDER = ['sport', 'ernaehrung', 'selfcare', 'karriere', 'familie', 'finanzen'];

    // ══════════════════════════════════════════════════════════════
    // PERSISTENCE (localStorage)
    // ══════════════════════════════════════════════════════════════
    const STORAGE_KEY = 'eazly_data';
    function saveData() { try { const d = {...appData, activePillars: [...appData.activePillars]}; localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); } catch(e) { console.warn('Save failed', e); } }
    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) { const d = JSON.parse(raw); d.activePillars = new Set(d.activePillars || []); return d; }
      } catch(e) { console.warn('Load failed', e); }
      return null;
    }
    function nextId(arr) { return arr.length ? Math.max(...arr.map(x => x.id)) + 1 : 1; }

    const DEFAULT_DATA = {
      userName: '',
      onboardingDone: false,
      activePillars: new Set(),
      workouts: [],
      tasks: [],
      familyEvents: [],
      children: [],
      transactions: [],
      budget: { total: 0, categories: [] },
      notifications: [],
      mealPlan: { 0: {}, 1: {}, 2: {}, 3: {}, 4: {}, 5: {}, 6: {} },
      shoppingList: [],
      weightHistory: [],
      habits: [],
      calendarEvents: [],
      trackedMeals: [],
      caloriesGoal: 1800,
      userProfile: { gender: '', age: 0, height: 0, weight: 0, activity: '' },
      waterGlasses: 0,
      weeklyWorkouts: [0,0,0,0,0,0,0],
      selfcare: { mood: null, periodStart: null, cycleLength: 28, cycleLog: {} }
    };

    let appData = loadData() || JSON.parse(JSON.stringify(DEFAULT_DATA, (k, v) => v instanceof Set ? [] : v));
    if (!(appData.activePillars instanceof Set)) appData.activePillars = new Set(appData.activePillars || []);
    if (!appData.trackedMeals) appData.trackedMeals = [];
    if (!appData.selfcare) appData.selfcare = { mood: null, periodStart: null, cycleLength: 28, cycleLog: {} };
    if (!appData.selfcare.cycleLog) appData.selfcare.cycleLog = {};
    if (appData.selfcare.symptoms) { delete appData.selfcare.symptoms; delete appData.selfcare.cycleDay; }
    if (!appData.budget) appData.budget = { total: 0, categories: [] };
    if (!appData.userProfile) appData.userProfile = { gender: '', age: 0, height: 0, weight: 0, activity: '' };
    if (!appData.calendarEvents) appData.calendarEvents = [];

    // UI State (not persisted)
    let uiState = {
      currentScreen: appData.onboardingDone ? 'home' : 'onboarding',
      currentStep: 0,
      activeSteps: ['welcome', 'pillars'],
      selectedDate: new Date().getDate(),
      selectedMood: appData.selfcare ? appData.selfcare.mood : null,
      mealPlanDay: 0,
      selectedRecipe: null,
      modalOpen: false
    };

    // Compat wrapper so render functions work
    let state = {
      get userName() { return appData.userName; },
      set userName(v) { appData.userName = v; },
      get activePillars() { return appData.activePillars; },
      set activePillars(v) { appData.activePillars = v; },
      get currentScreen() { return uiState.currentScreen; },
      set currentScreen(v) { uiState.currentScreen = v; },
      get currentStep() { return uiState.currentStep; },
      set currentStep(v) { uiState.currentStep = v; },
      get activeSteps() { return uiState.activeSteps; },
      set activeSteps(v) { uiState.activeSteps = v; },
      get selectedDate() { return uiState.selectedDate; },
      set selectedDate(v) { uiState.selectedDate = v; },
      get selectedMood() { return uiState.selectedMood; },
      set selectedMood(v) { uiState.selectedMood = v; },
      get selectedRecipe() { return uiState.selectedRecipe; },
      set selectedRecipe(v) { uiState.selectedRecipe = v; },
      get mealPlanDay() { return uiState.mealPlanDay; },
      set mealPlanDay(v) { uiState.mealPlanDay = v; },
      get tasks() { return appData.tasks; },
      set tasks(v) { appData.tasks = v; },
      get workouts() { return appData.workouts; },
      set workouts(v) { appData.workouts = v; },
      get notifications() { return appData.notifications; },
      set notifications(v) { appData.notifications = v; },
      get caloriesGoal() { return appData.caloriesGoal; },
      set caloriesGoal(v) { appData.caloriesGoal = v; },
      get waterGlasses() { return appData.waterGlasses; },
      set waterGlasses(v) { appData.waterGlasses = v; },
      get weeklyWorkouts() { return appData.weeklyWorkouts; },
      set weeklyWorkouts(v) { appData.weeklyWorkouts = v; },
      get caloriesConsumed() { return appData.trackedMeals.reduce((s, m) => s + (m.calories || 0), 0); }
    };

    // ══════════════════════════════════════════════════════════════
    // GENERIC MODAL SYSTEM
    // ══════════════════════════════════════════════════════════════
    function openFormModal(config) {
      const { title, fields, onSave, saveLabel } = config;
      uiState.modalOpen = true;
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay active';
      overlay.id = 'formModal';
      overlay.onclick = (e) => { if (e.target === overlay) closeFormModal(); };
      const fieldHtml = fields.map((f, i) => {
        const id = 'mf_' + i;
        let input = '';
        if (f.type === 'text' || f.type === 'number') {
          input = `<input type="${f.type}" class="form-input" id="${id}" placeholder="${f.placeholder || ''}" value="${f.value || ''}" ${f.type === 'number' ? 'step="' + (f.step || 1) + '" min="' + (f.min || 0) + '"' : ''}>`;
        } else if (f.type === 'select') {
          input = `<select class="form-input" id="${id}">${f.options.map(o => `<option value="${o.value}" ${o.value === f.value ? 'selected' : ''}>${o.label}</option>`).join('')}</select>`;
        } else if (f.type === 'time') {
          input = `<input type="time" class="form-input" id="${id}" value="${f.value || ''}">`;
        } else if (f.type === 'date') {
          input = `<input type="date" class="form-input" id="${id}" value="${f.value || new Date().toISOString().split('T')[0]}">`;
        } else if (f.type === 'textarea') {
          input = `<textarea class="form-input" id="${id}" rows="3" placeholder="${f.placeholder || ''}">${f.value || ''}</textarea>`;
        } else if (f.type === 'radio') {
          input = `<div class="option-group">${f.options.map((o, oi) => `<button class="option-btn ${(f.value === o.value || (!f.value && oi === 0)) ? 'selected' : ''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected');this.dataset.value='${o.value}'" data-value="${o.value}">${o.label}</button>`).join('')}</div>`;
        }
        return `<div class="form-group"><label class="form-label">${f.label}</label>${input}</div>`;
      }).join('');
      overlay.innerHTML = `<div class="modal">
        <div class="modal-header"><h2 class="modal-title">${title}</h2><button class="modal-close" onclick="closeFormModal()"><span class="material-symbols-outlined">close</span></button></div>
        ${fieldHtml}
        <div class="modal-footer"><button class="btn btn-secondary" onclick="closeFormModal()">Abbrechen</button><button class="btn btn-primary" onclick="submitFormModal()">${saveLabel || 'Speichern'}</button></div>
      </div>`;
      document.body.appendChild(overlay);
      window._modalConfig = config;
      const firstInput = overlay.querySelector('input, select, textarea');
      if (firstInput) setTimeout(() => firstInput.focus(), 100);
    }
    function closeFormModal() {
      const m = document.getElementById('formModal');
      if (m) m.remove();
      uiState.modalOpen = false;
      window._modalConfig = null;
    }
    function submitFormModal() {
      const config = window._modalConfig;
      if (!config) return;
      const data = {};
      config.fields.forEach((f, i) => {
        const id = 'mf_' + i;
        if (f.type === 'radio') {
          const sel = document.querySelector('#formModal .form-group:nth-child(' + (i+2) + ') .option-btn.selected');
          data[f.key] = sel ? sel.dataset.value : f.options[0].value;
        } else {
          const el = document.getElementById(id);
          data[f.key] = el ? (f.type === 'number' ? parseFloat(el.value) || 0 : el.value) : '';
        }
      });
      if (config.onSave) config.onSave(data);
      closeFormModal();
      saveData();
      render();
    }
    function confirmDelete(msg, onConfirm) {
      if (confirm(msg)) { onConfirm(); saveData(); render(); }
    }

    // ══════════════════════════════════════════════════════════════
    // STEP TEMPLATES
    // ══════════════════════════════════════════════════════════════
    const STEPS = {
      welcome: { id: 'welcome', icon: 'waving_hand', iconClass: '', title: 'Willkommen bei eazly', subtitle: 'Lass uns dein Leben sanft organisieren.<br>Wie duerfen wir dich nennen?',
        html: () => `<div class="form-group"><label class="form-label">Dein Name</label><input type="text" class="form-input" id="userName" placeholder="z.B. Sarah" value="${state.userName}"></div>`,
        onNext: () => { state.userName = document.getElementById('userName').value || 'Du'; }
      },
      pillars: { id: 'pillars', icon: 'interests', iconClass: '', title: 'Deine Lebensbereiche', subtitle: 'Welche Bereiche moechtest du organisieren?',
        html: () => `<div class="pillar-grid">${PILLAR_ORDER.map(id => `<div class="pillar-card ${id}" data-pillar="${id}" onclick="togglePillar(this)"><span class="material-symbols-outlined">${PILLARS[id].icon}</span><span>${PILLARS[id].name}</span></div>`).join('')}</div><div class="info-message"><span class="material-symbols-outlined">info</span><span>Du kannst jederzeit Bereiche in den Einstellungen aendern.</span></div>`,
        onNext: () => {
          state.activePillars.clear();
          document.querySelectorAll('.pillar-card.selected').forEach(el => state.activePillars.add(el.dataset.pillar));
          if (state.activePillars.size === 0) { alert('Bitte waehle mindestens einen Bereich.'); return false; }
          buildSteps(); return true;
        }
      },
      sport: { id: 'sport', icon: 'fitness_center', iconClass: 'sport', title: 'Dein Sport', subtitle: 'Wie moechtest du dich fit halten?',
        html: () => `<div class="form-group"><label class="form-label">Fitness-Level</label><div class="option-group"><button class="option-btn selected" onclick="selectOption(this)">Einsteiger</button><button class="option-btn" onclick="selectOption(this)">Fortgeschritten</button><button class="option-btn" onclick="selectOption(this)">Profi</button></div></div><div class="slider-container"><div class="slider-header"><label class="form-label">Workouts pro Woche</label><span class="slider-value" id="workoutsValue">3x</span></div><input type="range" class="slider" min="1" max="7" value="3" oninput="updateSlider('workouts', this.value, 'x')"></div>`
      },
      ernaehrung: { id: 'ernaehrung', icon: 'restaurant', iconClass: 'ernaehrung', title: 'Deine Ernaehrung', subtitle: 'Wie ernaehrst du dich?',
        html: () => `<div class="form-group"><label class="form-label">Ernaehrungsform</label><div class="option-group"><button class="option-btn selected" onclick="selectOption(this)">Alles</button><button class="option-btn" onclick="selectOption(this)">Vegetarisch</button><button class="option-btn" onclick="selectOption(this)">Vegan</button></div></div>
        <div class="form-group"><label class="form-label">Kalorienziel bestimmen</label>
          <button class="option-btn selected" style="width:100%;padding:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px;justify-content:center;" onclick="openOnboardingCalorieCalc()"><span class="material-symbols-outlined" style="font-size:20px;">calculate</span>Kalorienbedarfsrechner nutzen</button>
          <div style="text-align:center;font-size:12px;color:var(--charcoal-light);margin:8px 0;">oder manuell waehlen:</div>
        </div>
        <div class="slider-container"><div class="slider-header"><label class="form-label">Kalorienziel</label><span class="slider-value" id="caloriesValue">${(appData.caloriesGoal||1800).toLocaleString('de-DE')} kcal</span></div><input type="range" class="slider" min="1200" max="3500" step="50" value="${appData.caloriesGoal||1800}" oninput="updateSlider('calories', this.value, ' kcal', true)"></div>`,
        onNext: () => { const slider = document.querySelector('.slider-container input[type=range]'); if (slider) { appData.caloriesGoal = parseInt(slider.value); } }
      },
      karriere: { id: 'karriere', icon: 'work', iconClass: 'karriere', title: 'Deine Karriere', subtitle: 'Was sind deine beruflichen Ziele?',
        html: () => `<div class="form-group"><label class="form-label">Status</label><div class="option-group"><button class="option-btn selected" onclick="selectOption(this)">Angestellt</button><button class="option-btn" onclick="selectOption(this)">Selbststaendig</button><button class="option-btn" onclick="selectOption(this)">Elternzeit</button></div></div>`
      },
      familie: { id: 'familie', icon: 'family_restroom', iconClass: 'familie', title: 'Deine Familie', subtitle: 'Erzaehl uns von deiner Familie',
        html: () => `<div class="form-group"><label class="form-label">Kinder</label><div class="children-list" id="childrenList"></div><button class="add-child-btn" onclick="addChild()" style="display:flex;align-items:center;gap:8px;padding:12px;border:2px dashed var(--sand);border-radius:var(--radius-sm);background:none;cursor:pointer;width:100%;font-family:var(--font-body);font-size:14px;color:var(--charcoal-light);"><span class="material-symbols-outlined">add</span>Kind hinzufuegen</button></div>`
      },
      selfcare: { id: 'selfcare', icon: 'spa', iconClass: 'selfcare', title: 'Deine Selfcare', subtitle: 'Wie moechtest du fuer dich sorgen?',
        html: () => `<div class="form-group"><label class="form-label">Was ist dir wichtig?</label><div class="option-group"><button class="option-btn selected" onclick="toggleOption(this)">Achtsamkeit</button><button class="option-btn" onclick="toggleOption(this)">Journaling</button><button class="option-btn" onclick="toggleOption(this)">Zyklustracking</button><button class="option-btn" onclick="toggleOption(this)">Stimmungstracker</button></div></div><div class="info-message"><span class="material-symbols-outlined">spa</span><span>Dein sicherer Ort. Alles hier ist nur fuer dich.</span></div>`
      },
      finanzen: { id: 'finanzen', icon: 'account_balance_wallet', iconClass: 'finanzen', title: 'Deine Finanzen', subtitle: 'Behalte den Ueberblick',
        html: () => `<div class="slider-container"><div class="slider-header"><label class="form-label">Monatliches Budget</label><span class="slider-value" id="budgetValue">3.500 EUR</span></div><input type="range" class="slider" min="1000" max="10000" step="100" value="${appData.budget.total || 3500}" oninput="updateSlider('budget', this.value, ' EUR', true)"></div>`,
        onNext: () => { const v = document.querySelector('input[type=range]'); if (v) { appData.budget.total = parseInt(v.value); } }
      }
    };

    // ══════════════════════════════════════════════════════════════
    // RENDER FUNCTIONS
    // ══════════════════════════════════════════════════════════════
    function render() {
      const app = document.getElementById('app');
      if (state.currentScreen === 'onboarding') {
        app.innerHTML = renderOnboarding();
      } else {
        app.innerHTML = renderMainApp();
      }
    }
    function emptyState(icon, title, desc, btnLabel, btnAction) {
      return `<div class="empty-state"><span class="material-symbols-outlined">${icon}</span><h3>${title}</h3><p>${desc}</p>${btnLabel ? `<button class="btn btn-primary" onclick="${btnAction}"><span class="material-symbols-outlined">add</span>${btnLabel}</button>` : ''}</div>`;
    }

    function renderOnboarding() {
      const step = STEPS[state.activeSteps[state.currentStep]];
      const isLast = state.currentStep === state.activeSteps.length - 1;
      
      return `
        <div class="onboarding">
          <div class="onboarding-header">
            <svg class="onboarding-logo" viewBox="0 0 100 100" fill="none">
              <defs>
                <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#C9A88C"/>
                  <stop offset="100%" stop-color="#9CB8A8"/>
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="44" stroke="url(#logoGrad)" stroke-width="3" fill="none"/>
              <path d="M32 42 C32 32, 42 24, 52 24 C62 24, 70 30, 70 38 C70 44, 66 48, 58 50 L32 50" stroke="url(#logoGrad)" stroke-width="4" stroke-linecap="round" fill="none"/>
              <path d="M32 50 C32 62, 42 72, 54 72 C64 72, 70 66, 70 60" stroke="url(#logoGrad)" stroke-width="4" stroke-linecap="round" fill="none"/>
              <circle cx="72" cy="60" r="3" fill="#9CB8A8"/>
              <path d="M20 78 Q50 88, 80 78" stroke="#C9A88C" stroke-width="1.5" fill="none" opacity="0.4"/>
            </svg>
            <div class="onboarding-brand">eazly</div>
          </div>
          <div class="onboarding-progress">
            ${state.activeSteps.map((_, i) => `<div class="progress-dot ${i < state.currentStep ? 'completed' : ''} ${i === state.currentStep ? 'active' : ''}"></div>`).join('')}
          </div>
          <div class="onboarding-content">
            <div class="onboarding-step active">
              <div class="step-icon ${step.iconClass}"><span class="material-symbols-outlined">${step.icon}</span></div>
              <h2 class="step-title">${step.title}</h2>
              <p class="step-subtitle">${step.subtitle}</p>
              <div class="step-content">${step.html()}</div>
              <div class="onboarding-nav">
                ${state.currentStep > 0 ? `<button class="btn btn-secondary" onclick="prevStep()"><span class="material-symbols-outlined">arrow_back</span>Zurück</button>` : ''}
                <button class="btn btn-primary" onclick="${isLast ? 'finishOnboarding()' : 'nextStep()'}">
                  ${isLast ? "Los geht's" : 'Weiter'}
                  <span class="material-symbols-outlined">${isLast ? 'check' : 'arrow_forward'}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderMainApp() {
      const screens = {
        home: renderHomeScreen,
        calendar: renderCalendarScreen,
        add: renderAddScreen,
        insights: renderInsightsScreen,
        profile: renderProfileScreen,
        notifications: renderNotificationsScreen,
        sport: renderSportDetail,
        ernaehrung: renderErnaehrungDetail,
        selfcare: renderSelfcareDetail,
        karriere: renderKarriereDetail,
        familie: renderFamilieDetail,
        finanzen: renderFinanzenDetail,
        recipe: renderRecipeDetail,
        mealplanner: renderMealPlanner,
        shoppinglist: renderShoppingList,
        weighttracking: renderWeightTracking,
        habits: renderHabitsScreen,
        premium: renderPremiumScreen
      };
      
      const screenFn = screens[state.currentScreen] || renderHomeScreen;
      const unreadCount = state.notifications.filter(n => n.unread).length;
      
      return `
        ${screenFn()}
        ${!['notifications', 'recipe', 'mealplanner', 'shoppinglist', 'weighttracking', 'habits', 'premium'].includes(state.currentScreen) && !PILLAR_ORDER.includes(state.currentScreen) ? `
        <nav class="bottom-nav">
          <button class="nav-item ${state.currentScreen === 'home' ? 'active' : ''}" onclick="navigate('home')"><span class="material-symbols-outlined">home</span><span>Home</span></button>
          <button class="nav-item ${state.currentScreen === 'calendar' ? 'active' : ''}" onclick="navigate('calendar')"><span class="material-symbols-outlined">calendar_month</span><span>Kalender</span></button>
          <button class="nav-item ${state.currentScreen === 'add' ? 'active' : ''}" onclick="navigate('add')"><span class="material-symbols-outlined">add_circle</span><span>Neu</span></button>
          <button class="nav-item ${state.currentScreen === 'insights' ? 'active' : ''}" onclick="navigate('insights')"><span class="material-symbols-outlined">insights</span><span>Insights</span></button>
          <button class="nav-item ${state.currentScreen === 'profile' ? 'active' : ''}" onclick="navigate('profile')"><span class="material-symbols-outlined">person</span><span>Profil</span></button>
        </nav>
        ` : ''}
      `;
    }

    function renderHomeScreen() {
      const greeting = getGreeting();
      const quote = APP_CONTENT.quotes[Math.floor(Math.random() * APP_CONTENT.quotes.length)];
      const unreadCount = appData.notifications.filter(n => n.unread).length;
      const totalSpent = appData.transactions.filter(t => t.amount < 0).reduce((s, t) => s + Math.abs(t.amount), 0);
      const budgetTotal = appData.budget.total || 0;
      const calConsumed = state.caloriesConsumed;

      const pillarData = {
        sport: { status: appData.workouts.length ? `${appData.workouts.filter(w => w.completed).length} von ${appData.workouts.length} Workouts` : 'Starte dein erstes Workout', progress: appData.workouts.length ? Math.round(appData.workouts.filter(w => w.completed).length / appData.workouts.length * 100) : 0 },
        ernaehrung: { status: `${calConsumed.toLocaleString('de-DE')} / ${state.caloriesGoal.toLocaleString('de-DE')} kcal`, progress: state.caloriesGoal ? Math.min(100, Math.round(calConsumed / state.caloriesGoal * 100)) : 0 },
        selfcare: { status: appData.habits.length ? `${appData.habits.filter(h => h.completedToday).length} von ${appData.habits.length} Gewohnheiten` : 'Erstelle deine erste Gewohnheit', progress: appData.habits.length ? Math.round(appData.habits.filter(h => h.completedToday).length / appData.habits.length * 100) : 0 },
        karriere: { status: appData.tasks.length ? `${appData.tasks.filter(t => !t.completed).length} Aufgaben offen` : 'Erstelle deine erste Aufgabe', progress: appData.tasks.length ? Math.round(appData.tasks.filter(t => t.completed).length / appData.tasks.length * 100) : 0 },
        familie: { status: appData.familyEvents.length ? `${appData.familyEvents[0].title}` : 'Plane deinen ersten Termin', progress: appData.familyEvents.length ? 50 : 0 },
        finanzen: { status: budgetTotal ? `${(budgetTotal - totalSpent).toLocaleString('de-DE')} EUR verbleibend` : 'Budget einrichten', progress: budgetTotal ? Math.min(100, Math.round((budgetTotal - totalSpent) / budgetTotal * 100)) : 0 }
      };

      const focusItems = [];
      if (state.activePillars.has('sport')) {
        const nw = appData.workouts.find(w => !w.completed);
        if (nw) focusItems.push({ pillar: 'sport', icon: 'fitness_center', title: nw.title, desc: `${nw.duration} Min`, time: nw.time });
      }
      if (state.activePillars.has('ernaehrung')) focusItems.push({ pillar: 'ernaehrung', icon: 'lunch_dining', title: 'Mahlzeit tracken', desc: `${calConsumed} / ${state.caloriesGoal} kcal`, time: '' });
      if (state.activePillars.has('selfcare')) focusItems.push({ pillar: 'selfcare', icon: 'spa', title: 'Selfcare Check-in', desc: 'Wie fuehlst du dich heute?', time: '' });
      if (state.activePillars.has('karriere')) {
        const nt = appData.tasks.find(t => !t.completed);
        if (nt) focusItems.push({ pillar: 'karriere', icon: 'task_alt', title: nt.text.substring(0, 25), desc: nt.meta || '', time: '' });
      }
      if (state.activePillars.has('familie') && appData.familyEvents.length) focusItems.push({ pillar: 'familie', icon: 'event', title: appData.familyEvents[0].title, desc: appData.familyEvents[0].location || '', time: appData.familyEvents[0].time });
      if (state.activePillars.has('finanzen') && budgetTotal) focusItems.push({ pillar: 'finanzen', icon: 'receipt_long', title: 'Budget Check', desc: `${budgetTotal ? Math.round(totalSpent / budgetTotal * 100) : 0}% ausgegeben`, time: '' });

      return `
        <div class="screen active">
          <header class="app-header">
            <div class="header-top">
              <div class="header-logo">
                <svg viewBox="0 0 100 100" fill="none"><defs><linearGradient id="hLogoGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#C9A88C"/><stop offset="100%" stop-color="#9CB8A8"/></linearGradient></defs><circle cx="50" cy="50" r="44" stroke="url(#hLogoGrad)" stroke-width="3" fill="none"/><path d="M32 42 C32 32, 42 24, 52 24 C62 24, 70 30, 70 38 C70 44, 66 48, 58 50 L32 50" stroke="url(#hLogoGrad)" stroke-width="4" stroke-linecap="round" fill="none"/><path d="M32 50 C32 62, 42 72, 54 72 C64 72, 70 66, 70 60" stroke="url(#hLogoGrad)" stroke-width="4" stroke-linecap="round" fill="none"/><circle cx="72" cy="60" r="3" fill="#9CB8A8"/></svg>
                <span>eazly</span>
              </div>
              <div class="header-actions">
                <button class="header-btn" onclick="navigate('notifications')"><span class="material-symbols-outlined">notifications</span>${unreadCount > 0 ? '<span class="notification-badge"></span>' : ''}</button>
                <button class="header-btn" onclick="navigate('profile')"><span class="material-symbols-outlined">settings</span></button>
              </div>
            </div>
            <div class="greeting"><div class="greeting-text">${greeting}, ${state.userName || 'Du'}</div><div class="greeting-date">${formatDate(new Date())}</div></div>
          </header>
          <div class="quote-card" onclick="this.querySelector('.quote-text').textContent = APP_CONTENT.quotes[Math.floor(Math.random() * APP_CONTENT.quotes.length)]"><p class="quote-text">${quote}</p></div>
          <div class="premium-banner" onclick="navigate('premium')"><div class="premium-banner-title">eazly Premium</div><div class="premium-banner-text">300+ Rezepte, Meal Planner & mehr</div><div class="premium-badge"><span class="material-symbols-outlined" style="font-size: 16px;">workspace_premium</span>7 Tage gratis testen</div></div>
          <section class="section"><div class="section-header"><h2 class="section-title">Deine Bereiche</h2></div>
            <div class="pillar-cards">
              ${PILLAR_ORDER.filter(id => state.activePillars.has(id)).map(id => {
                const p = PILLARS[id]; const data = pillarData[id]; const offset = 125.6 * (1 - data.progress / 100);
                return `<div class="dashboard-pillar ${id}" onclick="navigate('${id}')"><div class="pillar-icon"><span class="material-symbols-outlined">${p.icon}</span></div><div class="pillar-info"><div class="pillar-name">${p.name}</div><div class="pillar-status">${data.status}</div></div><div class="pillar-progress"><svg width="48" height="48" viewBox="0 0 48 48"><circle class="bg" cx="24" cy="24" r="20"/><circle class="progress" cx="24" cy="24" r="20" stroke-dasharray="125.6" stroke-dashoffset="${offset}"/></svg><span class="progress-text">${data.progress}%</span></div></div>`;
              }).join('')}
              ${state.activePillars.size < PILLAR_ORDER.length ? `<div class="add-area-card" onclick="openAddPillarModal()"><div class="pillar-icon"><span class="material-symbols-outlined">add</span></div><div class="pillar-info"><div class="pillar-name">Bereich hinzufuegen</div></div></div>` : ''}
            </div>
          </section>
          ${focusItems.length > 0 ? `<section class="section"><div class="section-header"><h2 class="section-title">Heute im Fokus</h2><span class="section-link" onclick="navigate('calendar')">Alle ansehen</span></div><div class="focus-cards">${focusItems.map(item => `<div class="focus-card ${item.pillar}" onclick="navigate('${item.pillar}')"><span class="material-symbols-outlined">${item.icon}</span><div class="focus-title">${item.title}</div><div class="focus-desc">${item.desc}</div>${item.time ? `<div class="focus-time">${item.time}</div>` : ''}</div>`).join('')}</div></section>` : ''}
          ${state.activePillars.has('karriere') && appData.tasks.length ? `<section class="section"><div class="section-header"><h2 class="section-title">Aufgaben</h2><span class="section-link" onclick="navigate('karriere')">Alle ansehen</span></div><div class="task-list">${appData.tasks.slice(0, 3).map(task => `<div class="task-item ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})"><div class="task-checkbox"><span class="material-symbols-outlined">check</span></div><div class="task-content"><div class="task-text">${task.text}</div><div class="task-meta">${task.meta}</div></div><div class="task-priority ${task.priority}"></div></div>`).join('')}</div></section>` : ''}
        </div>
        <div class="modal-overlay" id="addPillarModal"><div class="modal"><div class="modal-header"><h2 class="modal-title">Bereich hinzufuegen</h2><button class="modal-close" onclick="closeAddPillarModal()"><span class="material-symbols-outlined">close</span></button></div><div id="addPillarGrid">${PILLAR_ORDER.map(id => { const p = PILLARS[id]; const active = state.activePillars.has(id); return `<div class="add-pillar-item ${id} ${active ? 'disabled' : ''}" ${active ? '' : `onclick="addPillar('${id}')"`}><span class="material-symbols-outlined">${p.icon}</span><span>${p.name}</span>${active ? '<span class="material-symbols-outlined check">check</span>' : ''}</div>`; }).join('')}</div></div></div>
      `;
    }

    function renderCalendarScreen() {
      const today = new Date();
      const monthNames = ['Januar', 'Februar', 'Maerz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
      const dayNames = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
      const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
      const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
      const startDay = (firstDay.getDay() + 6) % 7;
      const eventDates = appData.calendarEvents.map(e => e.date);
      const selectedEvents = appData.calendarEvents.filter(e => e.date === state.selectedDate);
      let days = '';
      for (let i = 0; i < startDay; i++) days += '<div class="calendar-day other-month"></div>';
      for (let d = 1; d <= lastDay.getDate(); d++) {
        const isToday = d === today.getDate(); const isSelected = d === state.selectedDate; const hasEvent = eventDates.includes(d);
        days += `<div class="calendar-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" onclick="selectDate(${d})">${d}${hasEvent ? '<span class="event-dot"></span>' : ''}</div>`;
      }
      return `<div class="screen active">
        <header class="detail-header"><h1>Kalender</h1><button class="header-btn" onclick="openCalendarEventModal()"><span class="material-symbols-outlined">add</span></button></header>
        <div class="calendar-header"><span class="calendar-month">${monthNames[today.getMonth()]} ${today.getFullYear()}</span></div>
        <div class="calendar-grid">${dayNames.map(d => `<div class="calendar-day-name">${d}</div>`).join('')}${days}</div>
        <div class="calendar-events"><h3 class="section-title" style="padding: 0 0 12px;">Termine am ${state.selectedDate}. ${monthNames[today.getMonth()]}</h3>
          ${selectedEvents.length > 0 ? selectedEvents.map(e => `<div class="event-item ${e.pillar}"><div class="event-time">${e.time || 'Ganztaegig'}</div><div class="event-info"><div class="event-title">${e.title}</div></div><button onclick="event.stopPropagation();confirmDelete('Event loeschen?',()=>{appData.calendarEvents=appData.calendarEvents.filter(x=>x.id!==${e.id})})" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:20px;">delete</span></button></div>`).join('') : '<p style="color: var(--charcoal-light); text-align: center; padding: 20px;">Keine Termine an diesem Tag</p>'}
        </div></div>`;
    }

    function renderAddScreen() {
      const items = [];
      if (state.activePillars.has('sport')) items.push({ pillar: 'sport', name: 'Workout planen', desc: 'Neues Training hinzufuegen', action: 'openWorkoutModal()' });
      if (state.activePillars.has('ernaehrung')) items.push({ pillar: 'ernaehrung', name: 'Mahlzeit tracken', desc: 'Essen protokollieren', action: 'openMealModal()' });
      if (state.activePillars.has('selfcare')) items.push({ pillar: 'selfcare', name: 'Gewohnheit erstellen', desc: 'Neue Gewohnheit tracken', action: 'openHabitModal()' });
      if (state.activePillars.has('karriere')) items.push({ pillar: 'karriere', name: 'Aufgabe erstellen', desc: 'Neue Aufgabe anlegen', action: 'openTaskModal()' });
      if (state.activePillars.has('familie')) items.push({ pillar: 'familie', name: 'Familientermin', desc: 'Neuen Termin eintragen', action: 'openFamilyEventModal()' });
      if (state.activePillars.has('finanzen')) items.push({ pillar: 'finanzen', name: 'Transaktion erfassen', desc: 'Neue Transaktion', action: 'openTransactionModal()' });
      items.push({ pillar: '', name: 'Kalender-Event', desc: 'Neuen Termin erstellen', action: 'openCalendarEventModal()', icon: 'calendar_month' });
      return `<div class="screen active"><header class="detail-header"><h1>Neu erstellen</h1></header><div class="section" style="padding-top: 20px;"><div class="pillar-cards">${items.map(it => `<div class="dashboard-pillar ${it.pillar}" onclick="${it.action}"><div class="pillar-icon"><span class="material-symbols-outlined">add</span></div><div class="pillar-info"><div class="pillar-name">${it.name}</div><div class="pillar-status">${it.desc}</div></div></div>`).join('')}</div></div></div>`;
    }

    function renderInsightsScreen() {
      const ww = appData.weeklyWorkouts || [0,0,0,0,0,0,0];
      const calConsumed = state.caloriesConsumed;
      return `<div class="screen active"><header class="detail-header"><h1>Insights</h1></header>
        <div class="tabs"><button class="tab active">Woche</button><button class="tab">Monat</button></div>
        ${state.activePillars.has('sport') ? `<div class="chart-container"><h3 class="section-title" style="margin-bottom: 16px;">Sport Aktivitaet</h3><div class="chart-placeholder">${ww.map(m => `<div class="chart-bar" style="height: ${m ? m * 1.5 : 10}px; background: ${m ? 'var(--sport)' : 'var(--sand)'}"></div>`).join('')}</div><div class="chart-labels"><span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span></div></div>` : ''}
        <div class="stats-row">
          ${state.activePillars.has('sport') ? `<div class="stat-card"><div class="stat-value">${ww.reduce((a,b)=>a+b,0)}</div><div class="stat-label">Min Sport</div></div>` : ''}
          ${state.activePillars.has('karriere') ? `<div class="stat-card"><div class="stat-value">${appData.tasks.filter(t=>t.completed).length}</div><div class="stat-label">Tasks erledigt</div></div>` : ''}
          ${state.activePillars.has('ernaehrung') ? `<div class="stat-card"><div class="stat-value">${appData.waterGlasses}</div><div class="stat-label">Glaeser Wasser</div></div>` : ''}
          ${state.activePillars.has('finanzen') ? `<div class="stat-card"><div class="stat-value">${appData.transactions.filter(t=>t.amount<0).reduce((s,t)=>s+Math.abs(t.amount),0).toFixed(0)}</div><div class="stat-label">EUR Ausgaben</div></div>` : ''}
        </div></div>`;
    }

    function renderProfileScreen() {
      return `<div class="screen active"><header class="detail-header"><h1>Profil</h1></header>
        <div class="settings-content">
          <div class="profile-card"><div class="profile-avatar"><span class="material-symbols-outlined">person</span></div><div class="profile-info"><h3>${state.userName || 'Benutzer'}</h3><p>eazly Mitglied</p></div></div>
          <div class="settings-section"><h3 class="settings-section-title">Aktive Bereiche</h3><div class="settings-card">${PILLAR_ORDER.filter(id => state.activePillars.has(id)).map(id => { const p = PILLARS[id]; return `<div class="settings-item ${id}" onclick="navigate('${id}')"><span class="material-symbols-outlined">${p.icon}</span><div class="settings-item-content"><div class="settings-item-title">${p.name}</div><div class="settings-item-desc">Aktiv</div></div><span class="material-symbols-outlined chevron">chevron_right</span></div>`; }).join('')}</div></div>
          ${PILLAR_ORDER.filter(id => !state.activePillars.has(id)).length > 0 ? `<div class="settings-section"><h3 class="settings-section-title">Bereiche hinzufuegen</h3><div class="settings-card">${PILLAR_ORDER.filter(id => !state.activePillars.has(id)).map(id => { const p = PILLARS[id]; return `<div class="settings-item ${id} inactive" onclick="addPillar('${id}')"><span class="material-symbols-outlined">${p.icon}</span><div class="settings-item-content"><div class="settings-item-title">${p.name}</div><div class="settings-item-desc">Tippen zum Hinzufuegen</div></div><span class="material-symbols-outlined add-badge">add</span></div>`; }).join('')}</div></div>` : ''}
          <div class="settings-section"><h3 class="settings-section-title">Konto</h3><div class="settings-card">
            <div class="settings-item" onclick="restartOnboarding()"><span class="material-symbols-outlined">restart_alt</span><div class="settings-item-content"><div class="settings-item-title">Setup neu starten</div><div class="settings-item-desc">Onboarding erneut durchlaufen</div></div><span class="material-symbols-outlined chevron">chevron_right</span></div>
            <div class="settings-item danger" onclick="if(confirm('Alle Daten loeschen?')){localStorage.removeItem(STORAGE_KEY);location.reload();}"><span class="material-symbols-outlined">delete_forever</span><div class="settings-item-content"><div class="settings-item-title">Alle Daten loeschen</div><div class="settings-item-desc">App zuruecksetzen</div></div></div>
          </div></div>
        </div></div>`;
    }

    function renderNotificationsScreen() {
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Benachrichtigungen</h1>${appData.notifications.length ? `<button class="header-btn" onclick="markAllRead()"><span class="material-symbols-outlined">done_all</span></button>` : ''}</header>
        ${appData.notifications.length ? `<div class="notification-list">${appData.notifications.map(n => `<div class="notification-item ${n.unread ? 'unread' : ''}" onclick="markNotificationRead(${n.id})"><div class="notification-icon ${n.pillar}"><span class="material-symbols-outlined">${PILLARS[n.pillar] ? PILLARS[n.pillar].icon : 'info'}</span></div><div class="notification-content"><div class="notification-title">${n.title}</div><div class="notification-text">${n.text}</div><div class="notification-time">${n.time}</div></div></div>`).join('')}</div>` : emptyState('notifications', 'Keine Benachrichtigungen', 'Alles ruhig hier. Benachrichtigungen erscheinen, wenn du Erinnerungen erhaeltst.', '', '')}
      </div>`;
    }

    function renderSportDetail() {
      const cw = appData.workouts.filter(w => w.completed); const tm = cw.reduce((a,w) => a+w.duration, 0); const tc = cw.reduce((a,w) => a+w.calories, 0);
      const wh = appData.weightHistory; const lastW = wh.length ? wh[wh.length-1].weight + ' kg aktuell' : 'Noch kein Eintrag';
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Sport</h1><button class="header-btn" onclick="openWorkoutModal()"><span class="material-symbols-outlined">add</span></button></header>
        <div class="stats-row"><div class="stat-card"><div class="stat-value">${cw.length}/${appData.workouts.length}</div><div class="stat-label">Workouts</div></div><div class="stat-card"><div class="stat-value">${tm}</div><div class="stat-label">Minuten</div></div><div class="stat-card"><div class="stat-value">${tc}</div><div class="stat-label">Kalorien</div></div></div>
        <div class="section" style="padding-top: 0;"><div class="pillar-cards">
          <div class="dashboard-pillar sport" onclick="navigate('weighttracking')"><div class="pillar-icon"><span class="material-symbols-outlined">monitor_weight</span></div><div class="pillar-info"><div class="pillar-name">Gewichts-Tracking</div><div class="pillar-status">${lastW}</div></div><span class="material-symbols-outlined" style="color:var(--charcoal-light);">chevron_right</span></div>
          <div class="dashboard-pillar sport" onclick="navigate('habits')"><div class="pillar-icon"><span class="material-symbols-outlined">track_changes</span></div><div class="pillar-info"><div class="pillar-name">Gewohnheiten</div><div class="pillar-status">${appData.habits.filter(h=>h.completedToday).length} von ${appData.habits.length} heute</div></div><span class="material-symbols-outlined" style="color:var(--charcoal-light);">chevron_right</span></div>
        </div></div>
        <h3 class="section-title" style="padding: 0 20px 12px;">Heutige Workouts</h3>
        ${appData.workouts.length ? appData.workouts.map(w => `<div class="workout-card ${w.completed ? 'completed' : ''}"><div class="workout-header"><div class="workout-title">${w.title}</div><div style="display:flex;gap:8px;align-items:center;"><span class="workout-badge ${w.completed ? 'done' : 'planned'}" onclick="toggleWorkout(${w.id})">${w.completed ? 'Erledigt' : w.time}</span><button onclick="event.stopPropagation();confirmDelete('Workout loeschen?',()=>{appData.workouts=appData.workouts.filter(x=>x.id!==${w.id})})" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div></div><div class="workout-stats"><div class="workout-stat"><span class="material-symbols-outlined">schedule</span>${w.duration} Min</div><div class="workout-stat"><span class="material-symbols-outlined">local_fire_department</span>${w.calories} kcal</div></div></div>`).join('') : emptyState('fitness_center', 'Noch keine Workouts', 'Plane dein erstes Training!', 'Workout hinzufuegen', 'openWorkoutModal()')}
        <h3 class="section-title" style="padding: 20px 20px 12px;">Diese Woche</h3>
        <div class="chart-container" style="margin-top: 0;"><div class="chart-placeholder">${(appData.weeklyWorkouts||[0,0,0,0,0,0,0]).map(m => `<div class="chart-bar" style="height:${m?m*1.5:10}px;background:${m?'var(--sport)':'var(--sand)'}"></div>`).join('')}</div><div class="chart-labels"><span>Mo</span><span>Di</span><span>Mi</span><span>Do</span><span>Fr</span><span>Sa</span><span>So</span></div></div>
      </div>`;
    }

    function renderErnaehrungDetail() {
      const calConsumed = state.caloriesConsumed;
      const calGoal = state.caloriesGoal;
      const calPct = calGoal ? Math.min(100, Math.round(calConsumed / calGoal * 100)) : 0;
      const remaining = Math.max(0, calGoal - calConsumed);
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Ernaehrung</h1><button class="header-btn" onclick="openMealModal()"><span class="material-symbols-outlined">add</span></button></header>
        <div style="margin:20px;padding:24px;background:var(--ernaehrung-bg);border-radius:var(--radius-md);">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <div><div style="font-size:32px;font-weight:700;font-family:var(--font-display);color:var(--charcoal);">${calConsumed.toLocaleString('de-DE')}</div><div style="font-size:13px;color:var(--charcoal-light);">von ${calGoal.toLocaleString('de-DE')} kcal</div></div>
            <div style="text-align:right;"><div style="font-size:20px;font-weight:600;color:var(--ernaehrung);">${remaining.toLocaleString('de-DE')}</div><div style="font-size:13px;color:var(--charcoal-light);">uebrig</div></div>
          </div>
          <div style="height:10px;background:var(--sand);border-radius:5px;overflow:hidden;margin-bottom:12px;"><div style="height:100%;width:${calPct}%;background:${calPct>100?'var(--danger)':calPct>80?'var(--warning)':'var(--ernaehrung)'};border-radius:5px;transition:width 0.3s;"></div></div>
          <div style="display:flex;gap:8px;">
            <button onclick="openCalorieCalculatorModal()" style="flex:1;padding:10px;border:1.5px solid var(--ernaehrung);border-radius:var(--radius-sm);background:none;cursor:pointer;font-family:var(--font-body);font-size:13px;color:var(--ernaehrung);display:flex;align-items:center;justify-content:center;gap:4px;"><span class="material-symbols-outlined" style="font-size:18px;">calculate</span>Bedarfsrechner</button>
            <button onclick="openManualCalorieGoalModal()" style="flex:1;padding:10px;border:1.5px solid var(--charcoal-light);border-radius:var(--radius-sm);background:none;cursor:pointer;font-family:var(--font-body);font-size:13px;color:var(--charcoal-light);display:flex;align-items:center;justify-content:center;gap:4px;"><span class="material-symbols-outlined" style="font-size:18px;">edit</span>Ziel anpassen</button>
          </div>
        </div>
        <div class="stats-row"><div class="stat-card"><div class="stat-value">${appData.waterGlasses}/8</div><div class="stat-label">Glaeser Wasser</div></div><div class="stat-card"><div class="stat-value">${appData.trackedMeals.length}</div><div class="stat-label">Mahlzeiten heute</div></div></div>
        <div class="section"><div class="section-header"><h2 class="section-title">Wasser Tracker</h2></div><div style="display:flex;gap:8px;flex-wrap:wrap;">${[1,2,3,4,5,6,7,8].map(i => `<div onclick="setWater(${i})" style="width:40px;height:40px;border-radius:50%;background:${i<=appData.waterGlasses?'var(--ernaehrung)':'var(--sand)'};display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;"><span class="material-symbols-outlined" style="color:${i<=appData.waterGlasses?'white':'var(--charcoal-light)'};font-size:20px;">water_drop</span></div>`).join('')}</div></div>
        ${appData.trackedMeals.length ? `<div class="section"><div class="section-header"><h2 class="section-title">Heutige Mahlzeiten</h2></div>${appData.trackedMeals.map(m => `<div class="workout-card"><div class="workout-header"><div class="workout-title">${m.name || m.type}</div><div style="display:flex;gap:8px;align-items:center;"><span class="workout-badge planned">${m.calories} kcal</span><button onclick="event.stopPropagation();confirmDelete('Mahlzeit loeschen?',()=>{appData.trackedMeals=appData.trackedMeals.filter(x=>x.id!==${m.id})})" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div></div></div>`).join('')}</div>` : ''}
        <div class="section"><div class="pillar-cards">
          <div class="dashboard-pillar ernaehrung" onclick="navigate('mealplanner')"><div class="pillar-icon"><span class="material-symbols-outlined">calendar_month</span></div><div class="pillar-info"><div class="pillar-name">Meal Planner</div><div class="pillar-status">Woche planen</div></div><span class="material-symbols-outlined" style="color:var(--charcoal-light);">chevron_right</span></div>
          <div class="dashboard-pillar ernaehrung" onclick="navigate('shoppinglist')"><div class="pillar-icon"><span class="material-symbols-outlined">shopping_cart</span></div><div class="pillar-info"><div class="pillar-name">Einkaufsliste</div><div class="pillar-status">${appData.shoppingList.filter(i=>!i.checked).length} Artikel offen</div></div><span class="material-symbols-outlined" style="color:var(--charcoal-light);">chevron_right</span></div>
        </div></div>
        <div class="section"><div class="section-header"><h2 class="section-title">Rezept-Ideen</h2></div></div>
        <div class="recipe-grid">${APP_CONTENT.recipes.slice(0, 4).map(r => `<div class="recipe-card" onclick="openRecipe(${r.id})"><div class="recipe-image"><span class="material-symbols-outlined">restaurant</span></div><div class="recipe-content"><div class="recipe-title">${r.title}</div><div class="recipe-meta"><span>${r.time} Min</span><span>${r.calories} kcal</span></div></div></div>`).join('')}</div>
      </div>`;
    }

    function renderKarriereDetail() {
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Karriere</h1><button class="header-btn" onclick="openTaskModal()"><span class="material-symbols-outlined">add</span></button></header>
        ${appData.tasks.length ? `<div class="stats-row"><div class="stat-card"><div class="stat-value">${appData.tasks.filter(t=>t.completed).length}/${appData.tasks.length}</div><div class="stat-label">Erledigt</div></div><div class="stat-card"><div class="stat-value">${appData.tasks.filter(t=>t.priority==='high'&&!t.completed).length}</div><div class="stat-label">Dringend</div></div></div>
        <div class="section"><div class="task-list">${appData.tasks.map(task => `<div class="task-item ${task.completed ? 'completed' : ''}"><div class="task-checkbox" onclick="toggleTask(${task.id})"><span class="material-symbols-outlined">check</span></div><div class="task-content" onclick="toggleTask(${task.id})"><div class="task-text">${task.text}</div><div class="task-meta">${task.meta}</div></div><div class="task-priority ${task.priority}"></div><button onclick="event.stopPropagation();confirmDelete('Aufgabe loeschen?',()=>{appData.tasks=appData.tasks.filter(x=>x.id!==${task.id})})" style="background:none;border:none;cursor:pointer;margin-left:8px;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div>`).join('')}</div></div>` : emptyState('task_alt', 'Keine Aufgaben', 'Erstelle deine erste Aufgabe und behalte den Ueberblick.', 'Aufgabe erstellen', 'openTaskModal()')}
      </div>`;
    }

    function renderFamilieDetail() {
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Familie</h1><button class="header-btn" onclick="openFamilyEventModal()"><span class="material-symbols-outlined">add</span></button></header>
        <div class="section" style="padding-top: 20px;"><div class="section-header"><h2 class="section-title">Kinder</h2><span class="section-link" onclick="openChildModal()">Kind hinzufuegen</span></div>
          ${appData.children.length ? `<div style="display:flex;gap:16px;flex-wrap:wrap;">${appData.children.map(c => `<div style="flex:1;min-width:120px;background:var(--familie-bg);padding:20px;border-radius:var(--radius-md);text-align:center;position:relative;"><button onclick="confirmDelete('${c.name} entfernen?',()=>{appData.children=appData.children.filter(x=>x.name!=='${c.name}')})" style="position:absolute;top:8px;right:8px;background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">close</span></button><div style="width:48px;height:48px;border-radius:50%;background:${c.color || 'var(--familie)'};display:flex;align-items:center;justify-content:center;margin:0 auto 8px;"><span class="material-symbols-outlined" style="font-size:28px;color:white;">${c.icon || 'face'}</span></div><div style="font-weight:600;">${c.name}</div><div style="font-size:13px;color:var(--charcoal-light);">${c.age} Jahre</div></div>`).join('')}</div>` : `<p style="color:var(--charcoal-light);text-align:center;padding:20px;cursor:pointer;" onclick="openChildModal()">Tippe hier um ein Kind hinzuzufuegen</p>`}
        </div>
        <div class="section"><div class="section-header"><h2 class="section-title">Anstehende Termine</h2></div>
          ${appData.familyEvents.length ? `<div class="calendar-events" style="padding:0;">${appData.familyEvents.map(e => `<div class="event-item familie"><div class="event-time">${e.time}</div><div class="event-info"><div class="event-title">${e.title}</div><div class="event-location">${e.location || ''}</div></div><button onclick="event.stopPropagation();confirmDelete('Termin loeschen?',()=>{appData.familyEvents=appData.familyEvents.filter(x=>x.id!==${e.id})})" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div>`).join('')}</div>` : emptyState('event', 'Keine Termine', 'Erstelle den ersten Familientermin.', 'Termin hinzufuegen', 'openFamilyEventModal()')}
        </div></div>`;
    }

    function renderFinanzenDetail() {
      const totalSpent = appData.transactions.filter(t => t.amount < 0).reduce((s, t) => s + Math.abs(t.amount), 0);
      const bt = appData.budget.total || 0;
      const remaining = bt - totalSpent;
      const pctSpent = bt ? Math.round(totalSpent / bt * 100) : 0;
      const catSpent = {};
      appData.transactions.filter(t => t.amount < 0).forEach(t => { catSpent[t.category] = (catSpent[t.category] || 0) + Math.abs(t.amount); });
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Finanzen</h1><button class="header-btn" onclick="openTransactionModal()"><span class="material-symbols-outlined">add</span></button></header>
        <div class="stats-row"><div class="stat-card"><div class="stat-value">${remaining.toLocaleString('de-DE')} EUR</div><div class="stat-label">Verbleibend</div></div><div class="stat-card"><div class="stat-value">${pctSpent}%</div><div class="stat-label">Ausgegeben</div></div></div>
        ${appData.budget.categories.length ? `<div class="section"><div class="section-header"><h2 class="section-title">Budget-Kategorien</h2><span class="section-link" onclick="openBudgetCategoryModal()">Kategorie +</span></div>${appData.budget.categories.map(c => { const spent = catSpent[c.name] || 0; const pct = c.budget ? Math.round(spent / c.budget * 100) : 0; return `<div style="margin-bottom:16px;"><div style="display:flex;justify-content:space-between;margin-bottom:6px;"><span style="font-weight:500;">${c.name}</span><span style="color:var(--charcoal-light);">${spent.toFixed(0)} / ${c.budget} EUR</span></div><div style="height:8px;background:var(--sand);border-radius:4px;overflow:hidden;"><div style="height:100%;width:${Math.min(100,pct)}%;background:${pct>90?'var(--danger)':pct>70?'var(--warning)':'var(--finanzen)'};border-radius:4px;"></div></div></div>`; }).join('')}</div>` : `<div class="section"><button class="btn btn-secondary" style="width:100%;" onclick="openBudgetCategoryModal()"><span class="material-symbols-outlined">add</span>Budget-Kategorie erstellen</button></div>`}
        <div class="section"><div class="section-header"><h2 class="section-title">Transaktionen</h2></div></div>
        ${appData.transactions.length ? `<div class="transaction-list">${appData.transactions.map(t => `<div class="transaction-item"><div class="transaction-icon"><span class="material-symbols-outlined">${t.icon || 'receipt'}</span></div><div class="transaction-info"><div class="transaction-name">${t.name}</div><div class="transaction-category">${t.category} ${t.date ? '- '+t.date : ''}</div></div><div class="transaction-amount ${t.amount > 0 ? 'income' : 'expense'}">${t.amount > 0 ? '+' : ''}${t.amount.toLocaleString('de-DE', {minimumFractionDigits: 2})} EUR</div><button onclick="event.stopPropagation();confirmDelete('Transaktion loeschen?',()=>{appData.transactions=appData.transactions.filter(x=>x.id!==${t.id})})" style="background:none;border:none;cursor:pointer;margin-left:8px;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div>`).join('')}</div>` : emptyState('account_balance_wallet', 'Keine Transaktionen', 'Erfasse deine erste Ausgabe oder Einnahme.', 'Transaktion erfassen', 'openTransactionModal()')}
      </div>`;
    }

    function renderRecipeDetail() {
      const recipe = APP_CONTENT.recipes.find(r => r.id === state.selectedRecipe) || APP_CONTENT.recipes[0];
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('ernaehrung')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Rezept</h1></header>
        <div class="recipe-detail-image"><span class="material-symbols-outlined">restaurant</span></div>
        <div class="recipe-detail-content"><h2 class="recipe-detail-title">${recipe.title}</h2>
          <div class="recipe-detail-meta"><span><span class="material-symbols-outlined">schedule</span>${recipe.time} Min</span><span><span class="material-symbols-outlined">signal_cellular_alt</span>${recipe.difficulty}</span></div>
          <div class="nutrition-grid"><div class="nutrition-item"><div class="nutrition-value">${recipe.calories}</div><div class="nutrition-label">Kalorien</div></div><div class="nutrition-item"><div class="nutrition-value">${recipe.protein}g</div><div class="nutrition-label">Protein</div></div><div class="nutrition-item"><div class="nutrition-value">${recipe.carbs}g</div><div class="nutrition-label">Kohlenh.</div></div><div class="nutrition-item"><div class="nutrition-value">${recipe.fat}g</div><div class="nutrition-label">Fett</div></div></div>
          <h3 class="section-title" style="margin-bottom: 12px;">Zutaten</h3>
          <div class="ingredient-list">${recipe.ingredients.map(i => `<div class="ingredient-item"><span class="material-symbols-outlined" style="color:var(--ernaehrung);">check_circle</span><span>${i}</span></div>`).join('')}</div>
          <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="appData.trackedMeals.push({id:nextId(appData.trackedMeals),name:'${recipe.title}',calories:${recipe.calories},type:'Rezept'});saveData();showToast('${recipe.calories} kcal hinzugefuegt!');navigate('ernaehrung');"><span class="material-symbols-outlined">add</span>Mahlzeit tracken</button>
        </div></div>`;
    }

    function renderMealPlanner() {
      const dayNames = ['Mo','Di','Mi','Do','Fr','Sa','So']; const sd = state.mealPlanDay || 0;
      if (!appData.mealPlan) appData.mealPlan = {0:{},1:{},2:{},3:{},4:{},5:{},6:{}};
      const plan = appData.mealPlan[sd] || {};
      const slots = [{key:'fruehstueck',label:'Fruehstueck',icon:'egg_alt'},{key:'mittag',label:'Mittagessen',icon:'lunch_dining'},{key:'abend',label:'Abendessen',icon:'dinner_dining'},{key:'snack',label:'Snack',icon:'cookie'}];
      const totalKcal = slots.reduce((s,sl) => s + (plan[sl.key]?plan[sl.key].kcal:0), 0);
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('ernaehrung')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Meal Planner</h1><button class="header-btn" onclick="navigate('shoppinglist')"><span class="material-symbols-outlined">shopping_cart</span></button></header>
        <div class="meal-day-tabs">${dayNames.map((d,i) => `<div class="meal-day-tab ${i===sd?'active':''}" onclick="state.mealPlanDay=${i};render();"><div class="day-name">${d}</div><div class="day-num">${new Date().getDate()-new Date().getDay()+1+i}</div></div>`).join('')}</div>
        <div class="meal-summary"><div class="meal-summary-item"><div class="meal-summary-value">${totalKcal}</div><div class="meal-summary-label">Kalorien</div></div></div>
        ${slots.map(s => { const meal = plan[s.key];
          if (meal) return `<div class="meal-slot" onclick="openRecipe(${meal.recipeId})"><div class="meal-slot-header"><span class="meal-slot-label">${s.label}</span><span class="meal-slot-kcal">${meal.kcal} kcal</span></div><div class="meal-slot-content"><div class="meal-slot-icon"><span class="material-symbols-outlined">${s.icon}</span></div><div class="meal-slot-info"><div class="meal-slot-title">${meal.title}</div><div class="meal-slot-meta">Tippen fuer Details</div></div><button onclick="event.stopPropagation();appData.mealPlan[${sd}]['${s.key}']=null;saveData();render();" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">close</span></button></div></div>`;
          return `<div class="meal-slot empty" onclick="openMealPlanSlotModal(${sd},'${s.key}')"><div class="meal-slot-header"><span class="meal-slot-label">${s.label}</span></div><div class="meal-slot-content"><div class="meal-slot-icon"><span class="material-symbols-outlined">add</span></div><div class="meal-slot-info"><div class="meal-slot-title">Mahlzeit hinzufuegen</div><div class="meal-slot-meta">Aus Rezepten waehlen</div></div></div></div>`;
        }).join('')}</div>`;
    }

    function renderShoppingList() {
      const cats = {}; appData.shoppingList.forEach(item => { if (!cats[item.category]) cats[item.category]=[]; cats[item.category].push(item); });
      const cc = appData.shoppingList.filter(i=>i.checked).length; const tc = appData.shoppingList.length;
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('ernaehrung')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Einkaufsliste</h1><button class="header-btn" onclick="openShoppingItemModal()"><span class="material-symbols-outlined">add</span></button></header>
        ${tc ? `<div class="stats-row"><div class="stat-card"><div class="stat-value">${cc}/${tc}</div><div class="stat-label">Erledigt</div></div><div class="stat-card"><div class="stat-value">${tc-cc}</div><div class="stat-label">Noch offen</div></div></div>
        <div class="shopping-section">${Object.entries(cats).map(([cat,items]) => `<div class="shopping-category"><div class="shopping-category-title">${cat}</div>${items.map(item => `<div class="shopping-item ${item.checked?'checked':''}" onclick="toggleShoppingItem(${item.id})"><div class="shopping-check"><span class="material-symbols-outlined">check</span></div><span class="shopping-text">${item.text}</span><span class="shopping-amount">${item.amount}</span><button onclick="event.stopPropagation();confirmDelete('Artikel loeschen?',()=>{appData.shoppingList=appData.shoppingList.filter(x=>x.id!==${item.id})})" style="background:none;border:none;cursor:pointer;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:16px;">close</span></button></div>`).join('')}</div>`).join('')}</div>` : emptyState('shopping_cart', 'Einkaufsliste leer', 'Fuege Artikel zu deiner Einkaufsliste hinzu.', 'Artikel hinzufuegen', 'openShoppingItemModal()')}
      </div>`;
    }

    function renderWeightTracking() {
      const data = appData.weightHistory;
      if (!data.length) return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('sport')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Gewicht</h1></header>
        <div class="weight-input-card"><div style="text-align:center;margin-bottom:12px;font-size:13px;color:var(--charcoal-light);font-weight:600;text-transform:uppercase;">Heutiges Gewicht</div><div class="weight-input-row"><input type="number" class="weight-input" id="weightInput" value="70" step="0.1" min="40" max="200"><span class="weight-unit">kg</span></div><button class="btn btn-primary" style="width:100%;margin-top:12px;" onclick="saveWeight()"><span class="material-symbols-outlined">save</span>Speichern</button></div>
        ${emptyState('monitor_weight', 'Noch keine Eintraege', 'Trage dein erstes Gewicht ein um den Verlauf zu sehen.', '', '')}</div>`;
      const current = data[data.length-1].weight; const start = data[0].weight; const diff = (start-current).toFixed(1);
      const maxW = Math.max(...data.map(d=>d.weight)); const minW = Math.min(...data.map(d=>d.weight)); const range = maxW-minW||1;
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('sport')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Gewicht</h1></header>
        <div class="weight-input-card"><div style="text-align:center;margin-bottom:12px;font-size:13px;color:var(--charcoal-light);font-weight:600;text-transform:uppercase;">Heutiges Gewicht</div><div class="weight-input-row"><button class="btn btn-secondary btn-sm" onclick="adjustWeight(-0.1)"><span class="material-symbols-outlined">remove</span></button><input type="number" class="weight-input" id="weightInput" value="${current}" step="0.1" min="40" max="200"><span class="weight-unit">kg</span><button class="btn btn-secondary btn-sm" onclick="adjustWeight(0.1)"><span class="material-symbols-outlined">add</span></button></div><button class="btn btn-primary" style="width:100%;margin-top:12px;" onclick="saveWeight()"><span class="material-symbols-outlined">save</span>Speichern</button></div>
        <div class="weight-stats"><div class="weight-stat"><div class="weight-stat-value">${current} kg</div><div class="weight-stat-label">Aktuell</div></div><div class="weight-stat"><div class="weight-stat-value">${diff > 0 ? '-' : '+'}${Math.abs(diff)} kg</div><div class="weight-stat-label">Veraenderung</div></div></div>
        ${data.length > 1 ? `<div class="weight-chart"><h3 class="section-title" style="margin-bottom:16px;">Verlauf</h3><div class="weight-chart-area"><svg width="100%" height="100%" viewBox="0 0 300 140" preserveAspectRatio="none"><defs><linearGradient id="weightGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="var(--sport)" stop-opacity="0.3"/><stop offset="100%" stop-color="var(--sport)" stop-opacity="0"/></linearGradient></defs><path d="${data.map((d,i) => {const x=(i/(data.length-1))*300;const y=130-((d.weight-minW)/range)*120;return (i===0?'M':'L')+x+' '+y;}).join(' ')} L300 140 L0 140 Z" fill="url(#weightGrad)"/><path d="${data.map((d,i) => {const x=(i/(data.length-1))*300;const y=130-((d.weight-minW)/range)*120;return (i===0?'M':'L')+x+' '+y;}).join(' ')}" fill="none" stroke="var(--sport)" stroke-width="2.5" stroke-linecap="round"/>${data.map((d,i) => {const x=(i/(data.length-1))*300;const y=130-((d.weight-minW)/range)*120;return `<circle cx="${x}" cy="${y}" r="4" fill="var(--sport)" stroke="white" stroke-width="2"/>`;}).join('')}</svg></div><div class="weight-chart-labels">${data.map(d=>`<span>${d.date}</span>`).join('')}</div></div>` : ''}
      </div>`;
    }

    function renderHabitsScreen() {
      const todayIdx = (new Date().getDay()+6)%7; const ct = appData.habits.filter(h=>h.completedToday).length;
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Gewohnheiten</h1><button class="header-btn" onclick="openHabitModal()"><span class="material-symbols-outlined">add</span></button></header>
        ${appData.habits.length ? `<div class="stats-row"><div class="stat-card"><div class="stat-value">${ct}/${appData.habits.length}</div><div class="stat-label">Heute</div></div><div class="stat-card"><div class="stat-value">${appData.habits.length ? Math.max(...appData.habits.map(h=>h.streak)) : 0}</div><div class="stat-label">Beste Streak</div></div></div>
        <div class="habit-list">${appData.habits.map(h => `<div class="habit-card ${h.completedToday?'completed-today':''}"><div class="habit-header"><div class="habit-icon" style="background:${h.color}"><span class="material-symbols-outlined">${h.icon}</span></div><div class="habit-info"><div class="habit-name">${h.name}</div><div class="habit-streak"><span class="material-symbols-outlined">local_fire_department</span>${h.streak} Tage Streak</div></div><button class="habit-check-btn ${h.completedToday?'checked':''}" onclick="toggleHabit(${h.id})"><span class="material-symbols-outlined">check</span></button><button onclick="event.stopPropagation();confirmDelete('Gewohnheit loeschen?',()=>{appData.habits=appData.habits.filter(x=>x.id!==${h.id})})" style="background:none;border:none;cursor:pointer;margin-left:8px;"><span class="material-symbols-outlined" style="color:var(--danger);font-size:18px;">delete</span></button></div><div class="habit-week">${(h.weekDays||[false,false,false,false,false,false,false]).map((done,i)=>`<div class="habit-day ${done?'done':''} ${i===todayIdx?'today':''}"></div>`).join('')}</div></div>`).join('')}</div>` : emptyState('track_changes', 'Keine Gewohnheiten', 'Erstelle deine erste Gewohnheit und starte einen Streak!', 'Gewohnheit erstellen', 'openHabitModal()')}
      </div>`;
    }

    function renderSelfcareDetail() {
      const moods = [{icon:'bedtime',label:'Muede',value:1,color:'#A8B4C9'},{icon:'sentiment_dissatisfied',label:'Traurig',value:2,color:'#D4A5A5'},{icon:'sentiment_neutral',label:'Okay',value:3,color:'#C9A87C'},{icon:'sentiment_satisfied',label:'Gut',value:4,color:'#9CB8A8'},{icon:'sentiment_very_satisfied',label:'Super',value:5,color:'#7CB87C'}];
      const prompt = APP_CONTENT.journalPrompts[Math.floor(Math.random()*APP_CONTENT.journalPrompts.length)];
      const exercise = APP_CONTENT.miniExercises[Math.floor(Math.random()*APP_CONTENT.miniExercises.length)];
      const sc = appData.selfcare;
      // Zyklus-Berechnung
      const today = new Date(); const todayStr = today.toISOString().split('T')[0];
      let cycleDay = 0; let cyclePhase = ''; let nextPeriod = '';
      if (sc.periodStart) {
        const ps = new Date(sc.periodStart);
        const diffMs = today - ps; const diffDays = Math.floor(diffMs / 86400000);
        cycleDay = (diffDays % (sc.cycleLength || 28)) + 1;
        if (cycleDay <= 5) cyclePhase = 'Menstruation';
        else if (cycleDay <= 13) cyclePhase = 'Follikelphase';
        else if (cycleDay <= 16) cyclePhase = 'Eisprung';
        else cyclePhase = 'Lutealphase';
        const daysLeft = (sc.cycleLength || 28) - cycleDay;
        nextPeriod = daysLeft <= 0 ? 'Faellig' : 'in ' + daysLeft + ' Tagen';
      }
      const todayLog = (sc.cycleLog && sc.cycleLog[todayStr]) || [];
      const cycleProgress = cycleDay ? Math.round((cycleDay / (sc.cycleLength || 28)) * 100) : 0;
      // Symptom-Kategorien
      const symptomCategories = [
        { title: 'Blutung', icon: 'water_drop', items: ['Leicht','Mittel','Stark','Schmierblutung'] },
        { title: 'Ausfluss', icon: 'opacity', items: ['Klar','Cremig','Waessrig','Klebrig'] },
        { title: 'Schmerzen', icon: 'healing', items: ['Kopfschmerzen','Bauchschmerzen','Unterleibskraempfe','Rueckenschmerzen','Brustspannen'] },
        { title: 'Stimmung', icon: 'mood', items: ['Gluecklich','Traurig','Gereizt','Aengstlich','Energiegeladen','Erschoepft','Sensibel'] },
        { title: 'Koerper', icon: 'accessibility_new', items: ['Blaehungen','Uebelkeit','Heisshunger','Appetitlos','Schlafprobleme','Hautunreinheiten'] },
        { title: 'Intimität', icon: 'favorite', items: ['Lustempfinden hoch','Lustempfinden niedrig','Geschlechtsverkehr'] }
      ];

      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Selfcare</h1></header>
        <div class="section" style="padding-top:20px;"><div class="section-header"><h2 class="section-title">Wie fuehlst du dich?</h2></div><div style="display:flex;justify-content:space-between;gap:8px;">${moods.map(m => `<div onclick="selectMood(${m.value})" style="flex:1;text-align:center;padding:14px 4px;background:${state.selectedMood===m.value?'var(--selfcare-bg)':'var(--cream)'};border:2px solid ${state.selectedMood===m.value?'var(--selfcare)':'transparent'};border-radius:var(--radius-sm);cursor:pointer;transition:all 0.2s;"><span class="material-symbols-outlined" style="font-size:32px;color:${state.selectedMood===m.value?m.color:'var(--charcoal-light)'};">${m.icon}</span><div style="font-size:11px;color:var(--charcoal-light);margin-top:4px;">${m.label}</div></div>`).join('')}</div></div>

        <div class="section"><div class="section-header"><h2 class="section-title">Zyklustracker</h2></div>
          <div style="background:var(--warmwhite);border:1.5px solid var(--sand);border-radius:var(--radius-md);padding:20px;">
            ${sc.periodStart ? `
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                <div><div style="font-size:24px;font-weight:700;color:var(--selfcare);">Tag ${cycleDay}</div><div style="font-size:13px;color:var(--charcoal-light);">von ${sc.cycleLength} Tagen</div></div>
                <div style="text-align:right;"><div style="font-size:14px;font-weight:600;color:var(--charcoal);">${cyclePhase}</div><div style="font-size:12px;color:var(--charcoal-light);">Naechste Periode: ${nextPeriod}</div></div>
              </div>
              <div style="height:10px;background:var(--sand);border-radius:5px;overflow:hidden;margin-bottom:8px;position:relative;">
                <div style="height:100%;width:${Math.min(100,cycleProgress)}%;border-radius:5px;background:${cycleDay<=5?'var(--danger)':cycleDay<=13?'var(--selfcare)':cycleDay<=16?'var(--warning)':'var(--karriere)'};transition:width 0.3s;"></div>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--charcoal-light);margin-bottom:16px;">
                <span>Menstruation</span><span>Follikel</span><span>Eisprung</span><span>Luteal</span>
              </div>
              <div style="display:flex;gap:8px;margin-bottom:12px;">
                <button class="btn btn-secondary btn-sm" style="flex:1;" onclick="openPeriodStartModal()"><span class="material-symbols-outlined" style="font-size:18px;">edit_calendar</span>Periode anpassen</button>
                <button class="btn btn-secondary btn-sm" style="flex:1;" onclick="setCycleNewPeriod()"><span class="material-symbols-outlined" style="font-size:18px;">restart_alt</span>Periode heute</button>
              </div>
            ` : `
              <div style="text-align:center;padding:20px 0;">
                <span class="material-symbols-outlined" style="font-size:48px;color:var(--selfcare);margin-bottom:12px;">cycle</span>
                <h3 style="font-family:var(--font-display);font-size:20px;margin-bottom:8px;">Zyklustracking starten</h3>
                <p style="color:var(--charcoal-light);font-size:14px;margin-bottom:20px;">Wann hat deine letzte Periode begonnen?</p>
                <button class="btn btn-primary" onclick="openPeriodStartModal()"><span class="material-symbols-outlined">edit_calendar</span>Periodenstart eingeben</button>
              </div>
            `}
          </div>
        </div>

        ${sc.periodStart ? `
        <div class="section"><div class="section-header"><h2 class="section-title">Heutige Symptome</h2><span style="font-size:12px;color:var(--charcoal-light);">${todayLog.length} erfasst</span></div>
          ${symptomCategories.map(cat => `
            <div style="margin-bottom:16px;">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
                <span class="material-symbols-outlined" style="font-size:20px;color:var(--selfcare);">${cat.icon}</span>
                <span style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--charcoal-light);">${cat.title}</span>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                ${cat.items.map(s => `<button class="option-btn ${todayLog.includes(s)?'selected':''}" style="font-size:12px;padding:8px 14px;" onclick="toggleCycleSymptom('${s}')">${s}</button>`).join('')}
              </div>
            </div>
          `).join('')}
        </div>

        ${Object.keys(sc.cycleLog).length > 0 ? `
        <div class="section"><div class="section-header"><h2 class="section-title">Letzte Eintraege</h2></div>
          ${Object.entries(sc.cycleLog).sort((a,b) => b[0].localeCompare(a[0])).slice(0,5).map(([date, syms]) => {
            if (!syms.length) return '';
            const d = new Date(date); const dayStr = ('0'+d.getDate()).slice(-2)+'.'+('0'+(d.getMonth()+1)).slice(-2)+'.';
            return `<div style="display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid var(--sand);"><div style="min-width:50px;font-weight:600;font-size:13px;color:var(--charcoal);">${dayStr}</div><div style="display:flex;flex-wrap:wrap;gap:6px;">${syms.map(s => `<span style="font-size:11px;padding:4px 10px;background:var(--selfcare-bg);border-radius:20px;color:var(--selfcare);font-weight:500;">${s}</span>`).join('')}</div></div>`;
          }).join('')}
        </div>` : ''}
        ` : ''}

        <div class="premium-banner" style="background:linear-gradient(135deg,var(--selfcare),#9B7FA0);" onclick="showToast('Atme tief ein... und langsam aus...')"><div class="premium-banner-title">Notfall Selfcare</div><div class="premium-banner-text">Brauchst du gerade einen Moment fuer dich?</div><div class="premium-badge"><span class="material-symbols-outlined" style="font-size:18px;">spa</span>Jetzt durchatmen</div></div>
        <div class="section"><div class="section-header"><h2 class="section-title">Mini Achtsamkeit</h2><span class="section-link" onclick="render()">Neu laden</span></div><div class="workout-card" onclick="showToast('${exercise.title} gestartet!')"><div class="workout-header"><div class="workout-title">${exercise.title}</div><span class="workout-badge planned">${exercise.duration}</span></div><div class="workout-stats"><div class="workout-stat"><span class="material-symbols-outlined">${exercise.icon}</span>${exercise.desc}</div></div></div></div>
        <div class="section"><div class="section-header"><h2 class="section-title">Journal Prompt</h2><span class="section-link" onclick="render()">Anderer Prompt</span></div><div style="padding:20px;background:var(--selfcare-bg);border-radius:var(--radius-md);font-family:var(--font-display);font-size:18px;font-style:italic;color:var(--charcoal);line-height:1.5;">${prompt}</div><textarea style="width:100%;margin-top:12px;padding:14px;border:1.5px solid var(--sand);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:14px;min-height:100px;resize:vertical;background:var(--warmwhite);" placeholder="Schreibe hier deine Gedanken..."></textarea></div>
        <div class="section"><div class="section-header"><h2 class="section-title">Gewohnheiten</h2><span class="section-link" onclick="navigate('habits')">Alle ansehen</span></div>
          ${appData.habits.length ? `<div class="habit-list" style="padding:0;">${appData.habits.slice(0,3).map(h => `<div class="habit-card ${h.completedToday?'completed-today':''}"><div class="habit-header"><div class="habit-icon" style="background:${h.color}"><span class="material-symbols-outlined">${h.icon}</span></div><div class="habit-info"><div class="habit-name">${h.name}</div><div class="habit-streak"><span class="material-symbols-outlined">local_fire_department</span>${h.streak} Tage</div></div><button class="habit-check-btn ${h.completedToday?'checked':''}" onclick="toggleHabit(${h.id})"><span class="material-symbols-outlined">check</span></button></div></div>`).join('')}</div>` : `<p style="color:var(--charcoal-light);text-align:center;padding:20px;cursor:pointer;" onclick="openHabitModal()">Erstelle deine erste Gewohnheit</p>`}
        </div></div>`;
    }

    function renderPremiumScreen() {
      return `<div class="screen active"><header class="detail-header"><button class="back-btn" onclick="navigate('home')"><span class="material-symbols-outlined">arrow_back</span></button><h1>Premium</h1></header>
        <div style="text-align:center;padding:40px 20px 20px;"><div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--lotus-light),var(--lotus));display:flex;align-items:center;justify-content:center;margin:0 auto 16px;"><span class="material-symbols-outlined" style="font-size:40px;color:white;">workspace_premium</span></div><h2 style="font-family:var(--font-display);font-size:28px;margin-bottom:4px;">eazly Premium</h2><p style="color:var(--charcoal-light);font-size:15px;">Entfalte dein volles Potenzial</p></div>
        <div class="section"><ul class="premium-modal-features"><li><span class="material-symbols-outlined">restaurant</span>Alle 300+ Rezepte</li><li><span class="material-symbols-outlined">calendar_month</span>Meal Planner</li><li><span class="material-symbols-outlined">all_inclusive</span>Unbegrenzte Gewohnheiten</li><li><span class="material-symbols-outlined">monitor_weight</span>Gewichts-Tracking</li><li><span class="material-symbols-outlined">block</span>Keine Werbung</li></ul></div>
        <div class="section"><div class="premium-price-cards"><div class="premium-price-card" onclick="selectPricing(this)"><div class="premium-price-amount">4,99 EUR</div><div class="premium-price-period">pro Monat</div></div><div class="premium-price-card selected popular" onclick="selectPricing(this)"><div class="premium-price-amount">39,99 EUR</div><div class="premium-price-period">pro Jahr</div><div class="premium-price-save">33% sparen</div></div></div></div>
        <div class="section"><button class="btn btn-primary" style="width:100%;" onclick="showToast('Premium aktiviert!');createConfetti();setTimeout(()=>navigate('home'),1500);"><span class="material-symbols-outlined">workspace_premium</span>Jetzt Premium werden</button><p style="text-align:center;margin-top:12px;font-size:12px;color:var(--charcoal-light);">7 Tage kostenlos testen. Jederzeit kuendbar.</p></div></div>`;
    }

    // ══════════════════════════════════════════════════════════════
    // HELPER FUNCTIONS
    // ══════════════════════════════════════════════════════════════
    function getGreeting() { const h = new Date().getHours(); if (h < 12) return 'Guten Morgen'; if (h < 18) return 'Guten Tag'; return 'Guten Abend'; }
    function formatDate(date) { const days = ['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag']; const months = ['Januar','Februar','Maerz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember']; return `${days[date.getDay()]}, ${date.getDate()}. ${months[date.getMonth()]}`; }
    function buildSteps() { state.activeSteps = ['welcome', 'pillars']; PILLAR_ORDER.forEach(id => { if (state.activePillars.has(id)) state.activeSteps.push(id); }); }
    function togglePillar(el) { el.classList.toggle('selected'); }
    function selectOption(el) { el.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected')); el.classList.add('selected'); }
    function toggleOption(el) { el.classList.toggle('selected'); }
    function updateSlider(id, value, suffix, format = false) { const el = document.getElementById(id + 'Value'); if (el) el.textContent = (format ? Number(value).toLocaleString('de-DE') : value) + suffix; }
    function addChild() { const list = document.getElementById('childrenList'); if (!list) return; const div = document.createElement('div'); div.className = 'child-card'; div.innerHTML = `<input type="text" placeholder="Name"><input type="number" placeholder="Alter" min="0" max="25"><button class="remove-child" onclick="removeChild(this)"><span class="material-symbols-outlined">close</span></button>`; list.appendChild(div); }
    function removeChild(btn) { btn.parentElement.remove(); }

    function nextStep() { const step = STEPS[state.activeSteps[state.currentStep]]; if (step.onNext && step.onNext() === false) return; if (state.currentStep < state.activeSteps.length - 1) { state.currentStep++; render(); } }
    function prevStep() { if (state.currentStep > 0) { state.currentStep--; render(); } }
    function finishOnboarding() { const step = STEPS[state.activeSteps[state.currentStep]]; if (step.onNext) step.onNext(); appData.onboardingDone = true; state.currentScreen = 'home'; saveData(); render(); createConfetti(); }
    function navigate(screen) { state.currentScreen = screen; render(); window.scrollTo(0,0); }
    function openAddPillarModal() { const m = document.getElementById('addPillarModal'); if (m) m.classList.add('active'); }
    function closeAddPillarModal() { const m = document.getElementById('addPillarModal'); if (m) m.classList.remove('active'); }
    function addPillar(id) { state.activePillars.add(id); saveData(); closeAddPillarModal(); render(); createConfetti(); }

    function toggleTask(id) { const t = appData.tasks.find(t => t.id === id); if (t) { t.completed = !t.completed; saveData(); render(); if (t.completed) createConfetti(); } }
    function toggleWorkout(id) { const w = appData.workouts.find(w => w.id === id); if (w) { w.completed = !w.completed; if (w.completed) { const dayIdx = (new Date().getDay()+6)%7; appData.weeklyWorkouts[dayIdx] += w.duration; } saveData(); render(); if (w.completed) createConfetti(); } }
    function selectDate(day) { state.selectedDate = day; render(); }
    function setWater(glasses) { appData.waterGlasses = glasses; saveData(); render(); }
    function openRecipe(id) { state.selectedRecipe = id; navigate('recipe'); }
    function markNotificationRead(id) { const n = appData.notifications.find(n => n.id === id); if (n) n.unread = false; saveData(); render(); }
    function markAllRead() { appData.notifications.forEach(n => n.unread = false); saveData(); render(); }
    function toggleShoppingItem(id) { const item = appData.shoppingList.find(i => i.id === id); if (item) { item.checked = !item.checked; saveData(); render(); } }
    function toggleHabit(id) { const h = appData.habits.find(h => h.id === id); if (h) { h.completedToday = !h.completedToday; if (h.completedToday) { h.streak++; const di = (new Date().getDay()+6)%7; if (h.weekDays) h.weekDays[di] = true; createConfetti(); } else { h.streak = Math.max(0, h.streak-1); } saveData(); render(); } }
    function selectMood(value) { state.selectedMood = value; appData.selfcare.mood = value; saveData(); render(); showToast('Stimmung gespeichert!'); }
    function adjustWeight(delta) { const input = document.getElementById('weightInput'); if (input) input.value = (parseFloat(input.value) + delta).toFixed(1); }
    function saveWeight() { const input = document.getElementById('weightInput'); if (!input) return; const w = parseFloat(input.value); if (isNaN(w)) return; const today = new Date(); const dateStr = ('0'+today.getDate()).slice(-2)+'.'+('0'+(today.getMonth()+1)).slice(-2); appData.weightHistory.push({ date: dateStr, weight: w }); saveData(); render(); showToast('Gewicht gespeichert!'); }
    function selectPricing(el) { document.querySelectorAll('.premium-price-card').forEach(c => c.classList.remove('selected')); el.classList.add('selected'); }
    function toggleCycleSymptom(symptom) {
      const todayStr = new Date().toISOString().split('T')[0];
      if (!appData.selfcare.cycleLog) appData.selfcare.cycleLog = {};
      if (!appData.selfcare.cycleLog[todayStr]) appData.selfcare.cycleLog[todayStr] = [];
      const log = appData.selfcare.cycleLog[todayStr];
      const idx = log.indexOf(symptom);
      if (idx > -1) log.splice(idx, 1); else log.push(symptom);
      saveData(); render();
    }
    function openPeriodStartModal() {
      openFormModal({ title: 'Periodenstart', fields: [
        { key: 'periodStart', label: 'Erster Tag der letzten Periode', type: 'date', value: appData.selfcare.periodStart || new Date().toISOString().split('T')[0] },
        { key: 'cycleLength', label: 'Zykluslaenge (Tage)', type: 'number', placeholder: '28', value: appData.selfcare.cycleLength || 28, min: 20, step: 1 }
      ], onSave: (d) => {
        appData.selfcare.periodStart = d.periodStart;
        appData.selfcare.cycleLength = d.cycleLength || 28;
        showToast('Zyklusdaten gespeichert!');
      }});
    }
    function setCycleNewPeriod() {
      appData.selfcare.periodStart = new Date().toISOString().split('T')[0];
      saveData(); render(); showToast('Neuer Zyklus gestartet!');
    }
    function restartOnboarding() { appData.onboardingDone = false; state.currentStep = 0; state.activePillars.clear(); state.activeSteps = ['welcome', 'pillars']; state.currentScreen = 'onboarding'; saveData(); render(); }
    function showToast(message) { const t = document.createElement('div'); t.style.cssText = 'position:fixed;bottom:120px;left:50%;transform:translateX(-50%);background:var(--charcoal);color:white;padding:12px 24px;border-radius:50px;font-size:14px;z-index:500;animation:fadeIn 0.3s ease;'; t.textContent = message; document.body.appendChild(t); setTimeout(() => t.remove(), 2000); }
    function createConfetti() { const colors = ['#C9A88C','#9CB8A8','#C9A87C','#A8B4C9','#D4A5A5','#A8B89D']; for (let i=0;i<50;i++) { const c = document.createElement('div'); c.className='confetti'; c.style.left=Math.random()*100+'vw'; c.style.background=colors[Math.floor(Math.random()*colors.length)]; c.style.animationDuration=(Math.random()*2+2)+'s'; c.style.animationDelay=Math.random()*0.5+'s'; c.style.borderRadius=Math.random()>0.5?'50%':'0'; document.body.appendChild(c); setTimeout(()=>c.remove(),3500); } }

    // ══════════════════════════════════════════════════════════════
    // MODAL OPENERS (Add-Formulare)
    // ══════════════════════════════════════════════════════════════
    function openWorkoutModal() { openFormModal({ title: 'Workout hinzufuegen', fields: [
      { key: 'title', label: 'Titel', type: 'text', placeholder: 'z.B. Morning Yoga' },
      { key: 'duration', label: 'Dauer (Min)', type: 'number', placeholder: '30', min: 1 },
      { key: 'calories', label: 'Kalorien', type: 'number', placeholder: '200', min: 0 },
      { key: 'time', label: 'Uhrzeit', type: 'time', value: '08:00' },
      { key: 'type', label: 'Typ', type: 'radio', options: [{value:'yoga',label:'Yoga'},{value:'running',label:'Laufen'},{value:'hiit',label:'HIIT'},{value:'strength',label:'Kraft'},{value:'swimming',label:'Schwimmen'}] }
    ], onSave: (d) => { appData.workouts.push({ id: nextId(appData.workouts), title: d.title||'Workout', duration: d.duration||30, calories: d.calories||0, time: d.time||'', completed: false, type: d.type||'yoga' }); showToast('Workout hinzugefuegt!'); } }); }

    function openMealModal() { openFormModal({ title: 'Mahlzeit tracken', fields: [
      { key: 'name', label: 'Name', type: 'text', placeholder: 'z.B. Mittagessen' },
      { key: 'calories', label: 'Kalorien', type: 'number', placeholder: '500', min: 0 },
      { key: 'type', label: 'Zeitpunkt', type: 'radio', options: [{value:'Fruehstueck',label:'Fruehstueck'},{value:'Mittag',label:'Mittag'},{value:'Abend',label:'Abend'},{value:'Snack',label:'Snack'}] }
    ], onSave: (d) => { appData.trackedMeals.push({ id: nextId(appData.trackedMeals), name: d.name||d.type, calories: d.calories||0, type: d.type||'Snack' }); showToast(d.calories + ' kcal getrackt!'); } }); }

    function openTaskModal() { openFormModal({ title: 'Aufgabe erstellen', fields: [
      { key: 'text', label: 'Aufgabe', type: 'text', placeholder: 'Was muss erledigt werden?' },
      { key: 'meta', label: 'Details', type: 'text', placeholder: 'z.B. Deadline, Notizen' },
      { key: 'priority', label: 'Prioritaet', type: 'radio', options: [{value:'high',label:'Hoch'},{value:'medium',label:'Mittel'},{value:'low',label:'Niedrig'}], value: 'medium' }
    ], onSave: (d) => { appData.tasks.push({ id: nextId(appData.tasks), text: d.text||'Neue Aufgabe', meta: d.meta||'', priority: d.priority||'medium', completed: false }); showToast('Aufgabe erstellt!'); } }); }

    function openFamilyEventModal() { openFormModal({ title: 'Familientermin', fields: [
      { key: 'title', label: 'Titel', type: 'text', placeholder: 'z.B. Zahnarzt Emma' },
      { key: 'time', label: 'Uhrzeit', type: 'time', value: '15:00' },
      { key: 'location', label: 'Ort', type: 'text', placeholder: 'z.B. Praxis Dr. Mueller' },
      { key: 'person', label: 'Person', type: 'text', placeholder: 'z.B. Emma' }
    ], onSave: (d) => { appData.familyEvents.push({ id: nextId(appData.familyEvents), title: d.title||'Termin', time: d.time||'', location: d.location||'', person: d.person||'' }); showToast('Termin hinzugefuegt!'); } }); }

    function openChildModal() { openFormModal({ title: 'Kind hinzufuegen', fields: [
      { key: 'name', label: 'Name', type: 'text', placeholder: 'Name des Kindes' },
      { key: 'age', label: 'Alter', type: 'number', placeholder: '5', min: 0 }
    ], onSave: (d) => { appData.children.push({ name: d.name||'Kind', age: d.age||0, icon: appData.children.length%2===0?'face':'face_6', color: 'var(--familie)' }); showToast(d.name + ' hinzugefuegt!'); } }); }

    function openTransactionModal() { openFormModal({ title: 'Transaktion erfassen', fields: [
      { key: 'name', label: 'Beschreibung', type: 'text', placeholder: 'z.B. REWE Einkauf' },
      { key: 'amount', label: 'Betrag (negativ = Ausgabe)', type: 'number', placeholder: '-50', step: 0.01 },
      { key: 'category', label: 'Kategorie', type: 'select', options: [{value:'Lebensmittel',label:'Lebensmittel'},{value:'Wohnen',label:'Wohnen'},{value:'Transport',label:'Transport'},{value:'Freizeit',label:'Freizeit'},{value:'Shopping',label:'Shopping'},{value:'Abonnement',label:'Abonnement'},{value:'Einkommen',label:'Einkommen'},{value:'Sonstiges',label:'Sonstiges'}], value: 'Lebensmittel' }
    ], onSave: (d) => { const icons = {Lebensmittel:'shopping_cart',Wohnen:'home',Transport:'directions_car',Freizeit:'sports_esports',Shopping:'shopping_bag',Abonnement:'play_circle',Einkommen:'payments',Sonstiges:'receipt'}; const today = new Date(); appData.transactions.unshift({ id: nextId(appData.transactions), name: d.name||'Transaktion', amount: d.amount||0, category: d.category||'Sonstiges', icon: icons[d.category]||'receipt', date: today.getDate()+'.'+(today.getMonth()+1)+'.' }); showToast('Transaktion erfasst!'); } }); }

    function openBudgetCategoryModal() { openFormModal({ title: 'Budget-Kategorie', fields: [
      { key: 'name', label: 'Kategorie', type: 'text', placeholder: 'z.B. Lebensmittel' },
      { key: 'budget', label: 'Budget (EUR)', type: 'number', placeholder: '500', min: 0 }
    ], onSave: (d) => { if (!appData.budget.categories) appData.budget.categories = []; appData.budget.categories.push({ name: d.name||'Kategorie', budget: d.budget||0 }); showToast('Kategorie erstellt!'); } }); }

    function openHabitModal() { openFormModal({ title: 'Gewohnheit erstellen', fields: [
      { key: 'name', label: 'Name', type: 'text', placeholder: 'z.B. Meditation' },
      { key: 'icon', label: 'Icon', type: 'radio', options: [{value:'self_improvement',label:'Meditation'},{value:'water_drop',label:'Wasser'},{value:'directions_walk',label:'Schritte'},{value:'edit_note',label:'Journaling'}] },
      { key: 'color', label: 'Farbe', type: 'radio', options: [{value:'var(--lotus)',label:'Lotus'},{value:'var(--sport)',label:'Sport'},{value:'var(--ernaehrung)',label:'Ernaehrung'},{value:'var(--selfcare)',label:'Selfcare'}] }
    ], onSave: (d) => { appData.habits.push({ id: nextId(appData.habits), name: d.name||'Gewohnheit', icon: d.icon||'self_improvement', color: d.color||'var(--lotus)', streak: 0, weekDays: [false,false,false,false,false,false,false], completedToday: false }); showToast('Gewohnheit erstellt!'); } }); }

    function openCalendarEventModal() { openFormModal({ title: 'Kalender-Event', fields: [
      { key: 'title', label: 'Titel', type: 'text', placeholder: 'z.B. Team Meeting' },
      { key: 'date', label: 'Tag im Monat', type: 'number', placeholder: String(new Date().getDate()), min: 1, value: state.selectedDate },
      { key: 'time', label: 'Uhrzeit', type: 'time', value: '10:00' },
      { key: 'pillar', label: 'Bereich', type: 'select', options: PILLAR_ORDER.map(id => ({value:id,label:PILLARS[id].name})), value: 'karriere' }
    ], onSave: (d) => { appData.calendarEvents.push({ id: nextId(appData.calendarEvents), title: d.title||'Event', date: parseInt(d.date)||new Date().getDate(), time: d.time||'', pillar: d.pillar||'karriere' }); showToast('Event hinzugefuegt!'); } }); }

    function openShoppingItemModal() { openFormModal({ title: 'Einkaufsartikel', fields: [
      { key: 'text', label: 'Artikel', type: 'text', placeholder: 'z.B. Haferflocken' },
      { key: 'amount', label: 'Menge', type: 'text', placeholder: 'z.B. 200g' },
      { key: 'category', label: 'Kategorie', type: 'select', options: [{value:'Obst & Gemuese',label:'Obst & Gemuese'},{value:'Proteine',label:'Proteine'},{value:'Getreide',label:'Getreide'},{value:'Milchprodukte',label:'Milchprodukte'},{value:'Getraenke',label:'Getraenke'},{value:'Sonstiges',label:'Sonstiges'}], value: 'Sonstiges' }
    ], onSave: (d) => { appData.shoppingList.push({ id: nextId(appData.shoppingList), text: d.text||'Artikel', amount: d.amount||'', category: d.category||'Sonstiges', checked: false }); showToast('Artikel hinzugefuegt!'); } }); }

    function openMealPlanSlotModal(day, slot) {
      const recipes = APP_CONTENT.recipes;
      openFormModal({ title: 'Rezept waehlen', fields: [
        { key: 'recipeId', label: 'Rezept', type: 'select', options: recipes.map(r => ({value: String(r.id), label: r.title + ' (' + r.calories + ' kcal)'})) }
      ], onSave: (d) => {
        const r = recipes.find(r => r.id === parseInt(d.recipeId));
        if (r) {
          if (!appData.mealPlan[day]) appData.mealPlan[day] = {};
          appData.mealPlan[day][slot] = { recipeId: r.id, title: r.title, kcal: r.calories };
          showToast(r.title + ' eingeplant!');
        }
      }});
    }

    // ══════════════════════════════════════════════════════════════
    // KALORIENBEDARFSRECHNER (Mifflin-St Jeor Formel)
    // ══════════════════════════════════════════════════════════════
    function calculateCalories(gender, age, height, weight, activity, goal) {
      // Mifflin-St Jeor: BMR berechnen
      let bmr;
      if (gender === 'weiblich') {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      }
      // Aktivitaetsfaktor
      const factors = { sedentary: 1.2, light: 1.375, moderate: 1.55, active: 1.725, very_active: 1.9 };
      const tdee = Math.round(bmr * (factors[activity] || 1.55));
      // Ziel-Anpassung
      if (goal === 'abnehmen') return Math.round(tdee - 500);
      if (goal === 'zunehmen') return Math.round(tdee + 300);
      return tdee; // halten
    }

    function openCalorieCalculatorModal() {
      const p = appData.userProfile || {};
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay active';
      overlay.id = 'calorieCalcModal';
      overlay.onclick = (e) => { if (e.target === overlay) { overlay.remove(); } };
      overlay.innerHTML = `<div class="modal" style="max-height:90vh;overflow-y:auto;">
        <div class="modal-header"><h2 class="modal-title">Kalorienbedarfsrechner</h2><button class="modal-close" onclick="document.getElementById('calorieCalcModal').remove()"><span class="material-symbols-outlined">close</span></button></div>
        <div style="padding:0 4px;">
          <div class="form-group"><label class="form-label">Geschlecht</label>
            <div class="option-group" id="cc_gender">
              <button class="option-btn ${p.gender==='weiblich'?'selected':(!p.gender?'selected':'')}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="weiblich">Weiblich</button>
              <button class="option-btn ${p.gender==='maennlich'?'selected':''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="maennlich">Maennlich</button>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div class="form-group"><label class="form-label">Alter</label><input type="number" class="form-input" id="cc_age" placeholder="30" min="14" max="100" value="${p.age||''}"></div>
            <div class="form-group"><label class="form-label">Groesse (cm)</label><input type="number" class="form-input" id="cc_height" placeholder="165" min="100" max="250" value="${p.height||''}"></div>
          </div>
          <div class="form-group"><label class="form-label">Gewicht (kg)</label><input type="number" class="form-input" id="cc_weight" placeholder="65" min="30" max="300" step="0.1" value="${p.weight||''}"></div>
          <div class="form-group"><label class="form-label">Aktivitaetslevel</label>
            <div class="option-group" id="cc_activity" style="flex-wrap:wrap;">
              <button class="option-btn ${p.activity==='sedentary'?'selected':''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="sedentary" style="font-size:12px;">Sitzend<br><span style="font-size:10px;opacity:0.7;">Bueroarbeit</span></button>
              <button class="option-btn ${p.activity==='light'?'selected':''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="light" style="font-size:12px;">Leicht aktiv<br><span style="font-size:10px;opacity:0.7;">1-2x Sport/Wo</span></button>
              <button class="option-btn ${p.activity==='moderate'?'selected':(!p.activity?'selected':'')}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="moderate" style="font-size:12px;">Moderat<br><span style="font-size:10px;opacity:0.7;">3-5x Sport/Wo</span></button>
              <button class="option-btn ${p.activity==='active'?'selected':''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="active" style="font-size:12px;">Aktiv<br><span style="font-size:10px;opacity:0.7;">6-7x Sport/Wo</span></button>
              <button class="option-btn ${p.activity==='very_active'?'selected':''}" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="very_active" style="font-size:12px;">Sehr aktiv<br><span style="font-size:10px;opacity:0.7;">Leistungssport</span></button>
            </div>
          </div>
          <div class="form-group"><label class="form-label">Ziel</label>
            <div class="option-group" id="cc_goal">
              <button class="option-btn" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="abnehmen"><span class="material-symbols-outlined" style="font-size:18px;">trending_down</span>Abnehmen</button>
              <button class="option-btn selected" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="halten"><span class="material-symbols-outlined" style="font-size:18px;">balance</span>Halten</button>
              <button class="option-btn" onclick="this.parentElement.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));this.classList.add('selected')" data-value="zunehmen"><span class="material-symbols-outlined" style="font-size:18px;">trending_up</span>Aufbauen</button>
            </div>
          </div>
          <div id="cc_result" style="display:none;margin-top:8px;padding:20px;background:var(--ernaehrung-bg);border-radius:var(--radius-md);text-align:center;">
            <div style="font-size:13px;color:var(--charcoal-light);margin-bottom:4px;">Dein empfohlener Tagesbedarf</div>
            <div id="cc_result_value" style="font-size:36px;font-weight:700;font-family:var(--font-display);color:var(--ernaehrung);"></div>
            <div style="font-size:13px;color:var(--charcoal-light);margin-top:2px;">Kalorien pro Tag</div>
            <div id="cc_result_details" style="margin-top:12px;font-size:12px;color:var(--charcoal-light);line-height:1.6;"></div>
          </div>
        </div>
        <div class="modal-footer" style="flex-direction:column;gap:8px;">
          <button class="btn btn-primary" style="width:100%;" onclick="runCalorieCalculation()"><span class="material-symbols-outlined">calculate</span>Berechnen</button>
          <button class="btn btn-secondary" id="cc_apply_btn" style="width:100%;display:none;" onclick="applyCalorieResult()"><span class="material-symbols-outlined">check</span>Als Kalorienziel uebernehmen</button>
        </div>
      </div>`;
      document.body.appendChild(overlay);
      setTimeout(() => { const first = overlay.querySelector('input'); if (first) first.focus(); }, 100);
    }

    function runCalorieCalculation() {
      const genderBtn = document.querySelector('#cc_gender .option-btn.selected');
      const gender = genderBtn ? genderBtn.dataset.value : 'weiblich';
      const age = parseInt(document.getElementById('cc_age').value) || 0;
      const height = parseInt(document.getElementById('cc_height').value) || 0;
      const weight = parseFloat(document.getElementById('cc_weight').value) || 0;
      const actBtn = document.querySelector('#cc_activity .option-btn.selected');
      const activity = actBtn ? actBtn.dataset.value : 'moderate';
      const goalBtn = document.querySelector('#cc_goal .option-btn.selected');
      const goal = goalBtn ? goalBtn.dataset.value : 'halten';

      if (!age || !height || !weight) {
        showToast('Bitte fulle Alter, Groesse und Gewicht aus');
        return;
      }

      const result = calculateCalories(gender, age, height, weight, activity, goal);
      window._calcCalorieResult = result;

      // Profil speichern
      appData.userProfile = { gender, age, height, weight, activity };
      saveData();

      // Ergebnis anzeigen
      const resultDiv = document.getElementById('cc_result');
      const resultVal = document.getElementById('cc_result_value');
      const resultDetails = document.getElementById('cc_result_details');
      const applyBtn = document.getElementById('cc_apply_btn');

      resultVal.textContent = result.toLocaleString('de-DE') + ' kcal';

      // BMR und TDEE fuer Details berechnen
      let bmr;
      if (gender === 'weiblich') { bmr = 10 * weight + 6.25 * height - 5 * age - 161; }
      else { bmr = 10 * weight + 6.25 * height - 5 * age + 5; }
      const factors = { sedentary: 1.2, light: 1.375, moderate: 1.55, active: 1.725, very_active: 1.9 };
      const tdee = Math.round(bmr * (factors[activity] || 1.55));
      const goalLabels = { abnehmen: 'Abnehmen (-500 kcal)', halten: 'Gewicht halten', zunehmen: 'Aufbauen (+300 kcal)' };

      resultDetails.innerHTML = `Grundumsatz (BMR): ${Math.round(bmr).toLocaleString('de-DE')} kcal<br>Gesamtumsatz (TDEE): ${tdee.toLocaleString('de-DE')} kcal<br>Ziel: ${goalLabels[goal] || 'Halten'}<br><span style="font-size:11px;opacity:0.7;">Berechnung nach Mifflin-St Jeor Formel</span>`;

      resultDiv.style.display = 'block';
      applyBtn.style.display = 'flex';
    }

    function applyCalorieResult() {
      if (window._calcCalorieResult) {
        appData.caloriesGoal = window._calcCalorieResult;
        saveData();
        showToast('Kalorienziel auf ' + window._calcCalorieResult.toLocaleString('de-DE') + ' kcal gesetzt!');
        document.getElementById('calorieCalcModal').remove();
        // Update slider in onboarding if present
        const slider = document.querySelector('.slider-container input[type=range]');
        const sliderVal = document.getElementById('caloriesValue');
        if (slider) { slider.value = window._calcCalorieResult; }
        if (sliderVal) { sliderVal.textContent = window._calcCalorieResult.toLocaleString('de-DE') + ' kcal'; }
        render();
        delete window._calcCalorieResult;
      }
    }

    function openOnboardingCalorieCalc() {
      openCalorieCalculatorModal();
    }

    function openManualCalorieGoalModal() {
      openFormModal({ title: 'Kalorienziel anpassen', fields: [
        { key: 'goal', label: 'Neues Kalorienziel (kcal)', type: 'number', placeholder: '1800', min: 800, step: 50, value: appData.caloriesGoal || 1800 }
      ], onSave: (d) => {
        const val = d.goal || 1800;
        appData.caloriesGoal = val;
        showToast('Kalorienziel auf ' + val.toLocaleString('de-DE') + ' kcal gesetzt!');
      }});
    }

    // ══════════════════════════════════════════════════════════════
    // INIT
    // ══════════════════════════════════════════════════════════════
    document.addEventListener('DOMContentLoaded', () => {
      if (appData.onboardingDone) {
        uiState.currentScreen = 'home';
      }
      render();
    });
  </script>
</body>
</html>
